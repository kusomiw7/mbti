<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI å»£å‘Šè§£é–æ¸¬é©—ç³»çµ± - æœ€çµ‚å®‰å…¨å„ªåŒ–ç‰ˆ</title>

    <meta name="google-adsense-account" content="ca-pub-2895749032536610"> 
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2895749032536610"
        crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        :root {
            font-family: 'Inter', sans-serif;
        }
        /* éš±è—æ»¾å‹•æ¢ */
        body {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        body::-webkit-scrollbar {
            display: none;
        }
        /* è‡ªå®šç¾©é¡è‰²é…ç½® */
        :root {
            --primary-indigo: #4F46E5;
            --ad-orange: #F97316;
        }
        /* ç¢ºä¿å°èˆªæ¬„çš„æ¨£å¼åœ¨ CDN è¼‰å…¥å‰å°±åˆå§‹åŒ–ï¼Œé˜²æ­¢é–ƒçˆ */
        .tab-btn {
            color: #6B7280; /* text-gray-500 default */
            background-color: transparent;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-indigo': '#4F46E5',
                        'primary-light': '#818CF8',
                        'accent-green': '#10B981',
                        'ad-orange': '#F97316',
                        'locked-gray': '#D1D5DB',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <header class="sticky top-0 bg-white shadow-lg z-20">
        <div class="max-w-4xl mx-auto flex justify-around p-2 border-b border-gray-200">
            <button id="tab1" onclick="setActiveTab('tab1')"
                class="tab-btn w-1/3 py-3 text-xs sm:text-base font-semibold rounded-lg transition duration-200">
                åŸºæœ¬æ¸¬é©— (16 é¡Œ)
            </button>
            <button id="tab2" onclick="setActiveTab('tab2')"
                class="tab-btn w-1/3 py-3 text-xs sm:text-base font-semibold rounded-lg transition duration-200">
                å°ˆå®¶æ¸¬é©— (69 é¡Œ)
            </button>
            <button id="tab3" onclick="setActiveTab('tab3')"
                class="tab-btn w-1/3 py-3 text-xs sm:text-base font-semibold rounded-lg transition duration-200">
                ç²¾æº– Pro (120 é¡Œ)
            </button>
        </div>
    </header>

    <main id="content-area" class="flex-grow max-w-4xl mx-auto p-4 sm:p-6 w-full">
        <div id="tab-content" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-t-4 border-primary-indigo">
            <p class="text-center text-gray-500 font-bold">ç³»çµ±æ­£åœ¨åˆå§‹åŒ–...</p>
        </div>
    </main>

    <script type="text/javascript">
        // --- æ ¸å¿ƒè³‡æ–™èˆ‡ç‹€æ…‹ ---
        const BASIC_QUIZ_COUNT = 16;
        const EXPERT_QUIZ_COUNT = 69;
        const CUSTOM_QUIZ_COUNT = 120;

        // JavaScript ç‹€æ…‹è®Šæ•¸
        let activeTab = 'tab1';
        let isExpertUnlocked = false;
        let isTab3Accessible = false;

        // å„²å­˜ç­”æ¡ˆ (ä½¿ç”¨ç¨€ç–é™£åˆ—)
        let basicAnswers = [];
        let expertAnswers = [];
        let customAnswers = [];

        // è¿½è¹¤ç”¨æˆ¶ç•¶å‰æ­£åœ¨æŸ¥çœ‹/ä½œç­”çš„é¡Œç›®ç´¢å¼• (0-based)
        let basicIndex = 0;
        let expertIndex = 0;
        let customIndex = 0;
        
        // ğŸŒŸ Ad-Blocker ç‹€æ…‹
        let isAdBlockerActive = false;
        
        // ğŸŒŸ ç”¨æ–¼é˜²æ­¢å‡è§£é–çš„æ™‚é–“æˆ³è¨˜ (Anti-Cheat)
        let pendingUnlockTarget = null;
        let pendingUnlockTimestamp = 0;
        const UNLOCK_DELAY_MS = 3000; // æ¨¡æ“¬å»£å‘Šè§€çœ‹/è¼‰å…¥çš„å»¶é²æ™‚é–“ (3ç§’)

        // 16 é¡ŒåŸºæœ¬æ¸¬é©— (å¯¦éš›é¡Œç›® - å…§å®¹ä¿æŒä¸è®Š)
        const basicQuestions = [
            { id: 1, text: "ç¶“éä¸€æ•´å¤©çš„å·¥ä½œæˆ–ç¤¾äº¤æ´»å‹•å¾Œï¼Œæ‚¨é€šå¸¸çš„æ„Ÿè¦ºæ˜¯ï¼š", options: ["ç²¾åŠ›å……æ²›ï¼Œé‚„æƒ³ç¹¼çºŒæ´»å‹•æˆ–äº¤è«‡ (E)", "æ„Ÿåˆ°ç–²æ†Šï¼Œéœ€è¦ç¨è™•ä¾†å……é›» (I)"], dichotomy: 'EI' },
            { id: 2, text: "åœ¨ä¸€å€‹å……æ»¿äººçš„å ´åˆä¸­ï¼Œæ‚¨å‚¾å‘æ–¼ï¼š", options: ["ç©æ¥µåƒèˆ‡ä¸¦æ˜¯ä¸»è¦çš„ç™¼è¨€äººä¹‹ä¸€ (E)", "ä¿æŒè§€å¯Ÿï¼Œæ›´å–œæ­¡ä¸€å°ä¸€æˆ–å°çµ„æ·±åº¦äº¤æµ (I)"], dichotomy: 'EI' },
            { id: 3, text: "æ‚¨æ›´å–œæ­¡è™•ç†å“ªç¨®è¨Šæ¯ï¼Ÿ", options: ["åœ¨å¤–ç•Œç™¼ç”Ÿçš„ã€å…·é«”çš„ã€å¯è¦‹çš„æ´»å‹• (E)", "åœ¨è…¦æµ·ä¸­ç™¼ç”Ÿçš„ã€å…§çœçš„ã€æƒ³åƒä¸­çš„æ´»å‹• (I)"], dichotomy: 'EI' },
            { id: 4, text: "æ‚¨èªç‚ºå¤šæ•¸äººå°æ‚¨çš„ç­è§£ç¨‹åº¦æ˜¯ï¼š", options: ["ç›¸ç•¶ä¸éŒ¯ï¼Œå› ç‚ºæ‚¨å¾ˆé–‹æ”¾ (E)", "ä¸å¤ æ·±å…¥ï¼Œå› ç‚ºæ‚¨è¼ƒç‚ºå…§æ–‚ (I)"], dichotomy: 'EI' },
            { id: 5, text: "åœ¨å­¸ç¿’æ–°æ±è¥¿æ™‚ï¼Œæ‚¨æ›´é‡è¦–ï¼š", options: ["å¯¦éš›çš„æ‡‰ç”¨ã€ç•¶å‰çš„ç´°ç¯€å’Œæ˜ç¢ºçš„æ­¥é©Ÿ (S)", "ç†è«–åŸºç¤ã€æŠ½è±¡æ¦‚å¿µå’Œæœªä¾†çš„å¯èƒ½æ€§ (N)"], dichotomy: 'SN' },
            { id: 6, text: "æ‚¨æœ€äº«å—çš„å°è©±å…§å®¹æ˜¯é—œæ–¼ï¼š", options: ["æ‰‹é‚Šçš„ä»»å‹™ã€çœŸå¯¦ç™¼ç”Ÿçš„äº‹ä»¶æˆ–å¯¦ç”¨è³‡è¨Š (S)", "å“²å­¸ã€é è¦‹ã€æ–°ç©çš„æƒ³æ³•æˆ–æ¯”å–» (N)"], dichotomy: 'SN' },
            { id: 7, text: "æ‚¨é€šå¸¸ä¿¡ä»»ï¼š", options: ["æ‚¨çš„éå»ç¶“é©—å’Œç¶“éé©—è­‰çš„äº‹å¯¦ (S)", "æ‚¨çš„éˆæ„Ÿã€ç›´è¦ºæˆ–å°æ¨¡å¼çš„æ´å¯Ÿ (N)"], dichotomy: 'SN' },
            { id: 8, text: "æ‚¨èªç‚ºè‡ªå·±æ˜¯ä¸€å€‹ï¼š", options: ["å‹™å¯¦ä¸”è…³è¸å¯¦åœ°çš„äºº (S)", "å¯Œæœ‰æƒ³åƒåŠ›å’ŒåŸå‰µæ€§çš„äºº (N)"], dichotomy: 'SN' },
            { id: 9, text: "ç•¶æ‚¨åšé‡å¤§æ±ºå®šæ™‚ï¼Œæ‚¨æœƒï¼š", options: ["ä¿æŒå®¢è§€ï¼Œæ¬Šè¡¡é‚è¼¯ã€æ•ˆç‡å’Œåˆ©å¼Š (T)", "è€ƒæ…®å°ä»–äººçš„å½±éŸ¿ã€æƒ…æ„Ÿåƒ¹å€¼å’Œå€‹äººæƒ…æ³ (F)"], dichotomy: 'TF' },
            { id: 10, text: "åœ¨æ‰¹è©•æˆ–æå‡ºåå°æ„è¦‹æ™‚ï¼Œæ‚¨å‚¾å‘æ–¼ï¼š", options: ["ç›´æ¥ã€å¦èª ï¼Œå°ˆæ³¨æ–¼å•é¡Œçš„è§£æ±º (T)", "æº«å’Œã€åœ“æ»‘ï¼Œç›¡é‡ç¶­è­·å’Œè«§çš„é—œä¿‚ (F)"], dichotomy: 'TF' },
            { id: 11, text: "æ‚¨èªç‚ºç¨±è®šä¸€å€‹äººæœ€å¥½æ˜¯ç¨±è®šå…¶ï¼š", options: ["æ™ºæ…§ã€é‚è¼¯æ€ç¶­æˆ–å…¬å¹³æ€§ (T)", "å–„è‰¯ã€åŒç†å¿ƒæˆ–ç†±å¿ƒåŠ©äºº (F)"], dichotomy: 'TF' },
            { id: 12, text: "æ‚¨èªç‚ºå…¬æ­£çš„æ±ºå®šæ‡‰è©²åŸºæ–¼ï¼š", options: ["ä¸€å¥—çµ±ä¸€ã€éå€‹äººçš„æ¨™æº– (T)", "æ¯å€‹äººçš„ç¨ç‰¹éœ€æ±‚å’Œåƒ¹å€¼è§€ (F)"], dichotomy: 'TF' },
            { id: 13, text: "å°æ–¼å‡æœŸæˆ–å¤§å°ˆæ¡ˆï¼Œæ‚¨å‚¾å‘æ–¼ï¼š", options: ["æå‰è¨ˆç•«ã€ç¢ºå®šç´°ç¯€ä¸¦æŒ‰æ™‚å®Œæˆ (J)", "ä¿æŒå½ˆæ€§ã€é–‹æ”¾é¸æ“‡ï¼Œä¸¦åœ¨ç•¶ä¸‹æ±ºå®š (P)"], dichotomy: 'JP' },
            { id: 14, text: "æ‚¨é€šå¸¸è¦ºå¾—æˆªæ­¢æ—¥æœŸæ˜¯ï¼š", options: ["å¿…é ˆéµå®ˆçš„ï¼Œé€™è®“æ‚¨æœ‰æ¢ç†åœ°å·¥ä½œ (J)", "å¯ä»¥èª¿æ•´çš„ï¼Œé€™è®“æ‚¨èƒ½å¤ é©æ‡‰è®ŠåŒ– (P)"], dichotomy: 'JP' },
            { id: 15, text: "æ‚¨çš„å·¥ä½œæˆ–ç”Ÿæ´»ç©ºé–“é€šå¸¸æ˜¯ï¼š", options: ["æ•´æ½”ã€æœ‰åºï¼Œæ‰€æœ‰æ±è¥¿éƒ½æœ‰å›ºå®šçš„ä½ç½® (J)", "éš¨æ€§ã€æœ‰æ©Ÿï¼Œé›œäº‚ä½†æ‚¨çŸ¥é“æ±è¥¿åœ¨å“ª (P)"], dichotomy: 'JP' },
            { id: 16, text: "æ‚¨å°‡ç”Ÿæ´»è¦–ç‚ºï¼š", options: ["éœ€è¦è¢«æ§åˆ¶ã€çµ„ç¹”å’Œåšå‡ºçµè«–çš„çµæ§‹ (J)", "éœ€è¦è¢«é«”é©—ã€æ¢ç´¢å’Œä¿æŒé–‹æ”¾çš„éç¨‹ (P)"], dichotomy: 'JP' },
        ];
        
        // éš¨æ©Ÿç²å–ä¸€å€‹ç¶­åº¦ (ç”¨æ–¼ä½”ä½é¡Œç›®)
        function getRandomDichotomy() {
            const dichotomies = ['EI', 'SN', 'TF', 'JP'];
            return dichotomies[Math.floor(Math.random() * dichotomies.length)];
        }
        
        // ä½”ä½å•é¡Œç”Ÿæˆå™¨ (ç”¨æ–¼å°ˆå®¶å’Œ Pro æ¸¬é©—)
        function generatePlaceholderQuestions(count, title, startIndex) {
            const questions = [];
            for (let i = 0; i < count; i++) {
                const dichotomy = getRandomDichotomy();
                questions.push({
                    id: startIndex + i,
                    text: `é€™æ˜¯ã€${title}ã€‘çš„ç¬¬ ${i + 1} é¡Œï¼ˆå…± ${count} é¡Œï¼‰ã€‚é€™æ˜¯ä¸€é“é€²éšå•é¡Œï¼Œæ¸¬é‡ [${dichotomy}] å‚¾å‘ã€‚`,
                    options: [
                        `é¸é … A: å‚¾å‘æ–¼ ${dichotomy.charAt(0)} ç¶­åº¦`,
                        `é¸é … B: å‚¾å‘æ–¼ ${dichotomy.charAt(1)} ç¶­åº¦`,
                    ],
                    dichotomy: dichotomy
                });
            }
            return questions;
        }

        const expertQuestions = generatePlaceholderQuestions(EXPERT_QUIZ_COUNT, 'å°ˆå®¶æ¸¬é©—', BASIC_QUIZ_COUNT + 1);
        const customQuestions = generatePlaceholderQuestions(CUSTOM_QUIZ_COUNT, 'ç²¾æº– Pro', BASIC_QUIZ_COUNT + EXPERT_QUIZ_COUNT + 1);

        // --- æ ¸å¿ƒåŠŸèƒ½: çœŸå¯¦ AdSense å»£å‘Šæ¸²æŸ“ (ç”¨æ–¼ä¸€èˆ¬é é¢) ---
        function getRealAdHtml(slotId = "1132687996") {
            // é è¨­ä½¿ç”¨åŸå§‹çš„é€šç”¨ ID
            const adSlotId = slotId; 
            
            return `
                <div class="pt-4 mt-8 bg-gray-100 shadow-inner rounded-xl text-center">
                    <h2 class="text-base font-bold text-gray-700 p-3 pb-2 border-b border-gray-200">
                        â”€â”€ è´ŠåŠ©å»£å‘Š (Google AdSense) â”€â”€
                    </h2>
                    <div class="w-full p-3 min-h-[100px] flex items-center justify-center">
                        <ins class="adsbygoogle"
                             style="display:block"
                             data-ad-client="ca-pub-2895749032536610"
                             data-ad-slot="${adSlotId}"  
                             data-ad-format="auto"
                             data-full-width-responsive="true"></ins>
                    </div>
                </div>
                <script>
                    try {
                        // ç•°æ­¥æ¨å…¥å»£å‘Šï¼Œè®“ Google è¼‰å…¥å…§å®¹
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    } catch (e) {
                        console.error("AdSense push failed:", e);
                    }
                <\/script>
            `;
        }

        // --- æ ¸å¿ƒåŠŸèƒ½: ç¬¬ä¸‰æ–¹å»£å‘Šæ¸²æŸ“ (ç”¨æ–¼è§£é–é é¢) ---
        // è™•ç† Expert Unlock (tab2) çš„è…³æœ¬
        function getThirdPartyAd1() {
            return `
                <div class="pt-4 mt-8 bg-pink-100 shadow-inner rounded-xl text-center border-t-4 border-pink-400">
                    <h2 class="text-base font-bold text-gray-700 p-3 pb-2 border-b border-gray-200">
                        â”€â”€ è´ŠåŠ©å•† 1 å»£å‘Š (è§£é–å°ˆå®¶æ¸¬é©—) â”€â”€
                    </h2>
                    <div class="w-full p-3 min-h-[100px] flex items-center justify-center text-sm text-gray-500">
                         é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¾Œï¼Œå»£å‘Šå°‡åœ¨èƒŒæ™¯é‹è¡Œ 3 ç§’ä»¥è§£é–ã€‚
                    </div>
                </div>
                <script>
                    (function(bbki){
                    var d = document,
                        s = d.createElement('script'),
                        l = d.scripts[d.scripts.length - 1];
                    s.settings = bbki || {};
                    s.src = "\/\/starry-perception.com\/cwD\/9q6Sb.2N5AlFSHWdQJ9pNmjrcvynNrjcUu2MNDyB0u2\/NazBIS2dNuTjYM4-";
                    s.async = true;
                    s.referrerPolicy = 'no-referrer-when-downgrade';
                    l.parentNode.insertBefore(s, l);
                    })({})
                <\/script>
            `;
        }

        // è™•ç† Pro Unlock (tab3) çš„è…³æœ¬
        function getThirdPartyAd2() {
            return `
                <div class="pt-4 mt-8 bg-yellow-100 shadow-inner rounded-xl text-center border-t-4 border-yellow-400">
                    <h2 class="text-base font-bold text-gray-700 p-3 pb-2 border-b border-gray-200">
                        â”€â”€ è´ŠåŠ©å•† 2 å»£å‘Š (è§£é–ç²¾æº– Pro) â”€â”€
                    </h2>
                    <div class="w-full p-3 min-h-[100px] flex items-center justify-center text-sm text-gray-500">
                         é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¾Œï¼Œå»£å‘Šå°‡åœ¨èƒŒæ™¯é‹è¡Œ 3 ç§’ä»¥è§£é–ã€‚
                    </div>
                </div>
                <script>
                    (function(rq){
                    var d = document,
                        s = d.createElement('script'),
                        l = d.scripts[d.scripts.length - 1];
                    s.settings = rq || {};
                    s.src = "\/\/starry-perception.com\/c.Dj9m6fbt2w5mlmSZWLQm9eNfjEcQyfN\/jCU\/2bO\/S\/0L2_NLz\/I\/2kN\/TEcnwH";
                    s.async = true;
                    s.referrerPolicy = 'no-referrer-when-downgrade';
                    l.parentNode.insertBefore(s, l);
                    })({})
                <\/script>
            `;
        }
        // -----------------------------------------------------------


        // --- è¼”åŠ©å‡½æ•¸: å–å¾—ç•¶å‰æ¸¬é©—çš„è³‡æ–™ ---
        function getQuizData(quizType) {
            if (quizType === 'basic') return { index: basicIndex, answers: basicAnswers, questions: basicQuestions, count: BASIC_QUIZ_COUNT, level: 'åˆéšå ±å‘Š (è¼ƒä½ç²¾æº–åº¦)', weight: 1.0 };
            if (quizType === 'expert') return { index: expertIndex, answers: expertAnswers, questions: expertQuestions, count: EXPERT_QUIZ_COUNT, level: 'ä¸­éšå ±å‘Š (ä¸­ç­‰ç²¾æº–åº¦)', weight: 1.2 };
            if (quizType === 'custom') return { index: customIndex, answers: customAnswers, questions: customQuestions, count: CUSTOM_QUIZ_COUNT, level: 'æœ€çµ‚å ±å‘Š (é«˜ç²¾æº–åº¦)', weight: 1.5 };
            return { index: 0, answers: [], questions: [], count: 0, level: 'N/A', weight: 0 };
        }

        // --- è¼”åŠ©å‡½æ•¸: è¨­å®šç•¶å‰æ¸¬é©—çš„ç´¢å¼• ---
        function setQuizIndex(quizType, newIndex) {
            if (quizType === 'basic') basicIndex = newIndex;
            else if (quizType === 'expert') expertIndex = newIndex;
            else if (quizType === 'custom') customIndex = newIndex;
        }

        // --- æ ¸å¿ƒå‡½æ•¸: å–å¾—å·²ä½œç­”é¡Œæ•¸ ---
        function getAnsweredCount(answers) {
            let count = 0;
            for (const answer of answers) {
                if (answer === 0 || answer === 1) {
                    count++;
                }
            }
            return count;
        }
        
        // --- æ¶ˆæ¯æ¡†å‡½æ•¸ ---
        function showMessageBox(message, callback = () => {}) {
            alert(message);
            callback();
        }

        // -----------------------------------------------------------
        // ğŸ›¡ï¸ Ad-Blocker åµæ¸¬ (æª¢æŸ¥ AdSense ä¸»è…³æœ¬æ˜¯å¦è¢«é˜»æ“‹)
        // -----------------------------------------------------------
        function checkAdBlocker() {
            // å¦‚æœ window.adsbygoogle è®Šæ•¸ä¸å­˜åœ¨ï¼Œè¡¨ç¤º Ad-Blocker å¾ˆå¯èƒ½é˜»æ­¢äº†ä¸»è…³æœ¬çš„è¼‰å…¥ã€‚
            isAdBlockerActive = (typeof window.adsbygoogle === 'undefined');
            return isAdBlockerActive;
        }
        // -----------------------------------------------------------


        // --- æ ¸å¿ƒåŠŸèƒ½: æ¸²æŸ“åˆ†é å…§å®¹ ---
        function renderTabContent() {
            const tabContentDiv = document.getElementById('tab-content');
            if (!tabContentDiv) return;

            let title = '';
            let contentHtml = '';
            
            let quizType;
            if (activeTab === 'tab1') quizType = 'basic';
            else if (activeTab === 'tab2') quizType = 'expert';
            else if (activeTab === 'tab3') quizType = 'custom';
            else return; 

            const quizData = getQuizData(quizType);
            const totalAnswered = getAnsweredCount(quizData.answers);
            
            try {
                // æª¢æŸ¥æ¸¬é©—æ˜¯å¦å·²å®Œæˆ
                if (totalAnswered === quizData.count) {
                    title = `ã€å·²å®Œæˆã€‘${quizData.level}`;
                    contentHtml = renderResults(quizType);
                } else if (activeTab === 'tab1') {
                    title = `ã€åŸºæœ¬æ¸¬é©—ã€‘ (é€²åº¦: ${totalAnswered} / ${BASIC_QUIZ_COUNT})`;
                    contentHtml = renderQuiz('basic');
                } else if (!isExpertUnlocked && activeTab === 'tab2') {
                    title = "ã€é–å®šã€‘å°ˆå®¶æ¸¬é©— (69 é¡Œ)";
                    contentHtml = renderLockedContent('å°ˆå®¶æ¸¬é©—', 'tab2');
                } else if (activeTab === 'tab2') {
                    title = `ã€å°ˆå®¶æ¸¬é©—ã€‘ (é€²åº¦: ${totalAnswered} / ${EXPERT_QUIZ_COUNT})`;
                    contentHtml = renderQuiz('expert');
                } else if (!isTab3Accessible && activeTab === 'tab3') {
                    title = `ã€é–å®šã€‘ç²¾æº– Pro (${CUSTOM_QUIZ_COUNT} é¡Œ)`;
                    contentHtml = renderLockedContent('ç²¾æº– Pro', 'tab3');
                } else if (activeTab === 'tab3') {
                    title = `ã€ç²¾æº– Proã€‘ (é€²åº¦: ${totalAnswered} / ${CUSTOM_QUIZ_COUNT})`;
                    contentHtml = renderQuiz('custom');
                }

                tabContentDiv.innerHTML = `
                    <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-800 mb-6 border-b-2 border-primary-light pb-2">
                        ${title}
                    </h1>
                    ${contentHtml}
                `;

            } catch (e) {
                console.error("Critical rendering error in renderTabContent:", e);
                tabContentDiv.innerHTML = `<div class="p-8 bg-red-100 text-red-700 font-bold text-center rounded-xl border border-red-500">
                    <p class="mb-2">âš ï¸ æ‡‰ç”¨ç¨‹å¼æ¸²æŸ“å¤±æ•—ã€‚è«‹åœ¨ç€è¦½å™¨æ§åˆ¶å° (F12) æª¢æŸ¥è©³ç´°éŒ¯èª¤ã€‚</p>
                </div>`;
            }
        }


        // --- æ¸²æŸ“æ¸¬é©—ä»‹é¢ ---
        function renderQuiz(quizType) {
            const data = getQuizData(quizType);
            const questions = data.questions;
            const answers = data.answers;
            let currentQIndex = data.index;
            const totalAnswered = getAnsweredCount(answers);
            
            if (currentQIndex > totalAnswered) {
                currentQIndex = totalAnswered;
                setQuizIndex(quizType, currentQIndex);
            }
            if (currentQIndex >= questions.length && totalAnswered === questions.length) {
                return `<div class="p-8 text-center bg-green-100 rounded-xl border border-green-500 text-green-700 font-bold">æ‰€æœ‰é¡Œç›®å‡å·²ä½œç­”ã€‚è«‹é»æ“Šä¸‹æ–¹çš„ã€Œå®Œæˆæ¸¬é©—ä¸¦æŸ¥çœ‹çµæœã€æŒ‰éˆ•ã€‚</div>`;
            }
            if (currentQIndex >= questions.length) {
                currentQIndex = questions.length - 1;
                setQuizIndex(quizType, currentQIndex);
            }

            const question = questions[currentQIndex];
            const savedAnswerIndex = answers[currentQIndex];
            const isAnswered = typeof savedAnswerIndex === 'number';
            const isLastQuestion = currentQIndex === questions.length - 1;
            const isNextDisabled = !isAnswered && (currentQIndex < questions.length);
            const nextButtonText = isLastQuestion ? 'å®Œæˆæ¸¬é©—ä¸¦æŸ¥çœ‹çµæœ' : 'ä¸‹ä¸€é¡Œ';

            return `
                <div class="mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-4 leading-relaxed">
                        <span class="text-primary-indigo font-extrabold">${currentQIndex + 1}.</span> ${question.text}
                    </h3>
                    <div class="space-y-4">
                        ${question.options.map((option, index) => {
                            const isSelected = savedAnswerIndex === index;
                            return `
                                <button onclick="submitAnswer('${quizType}', ${index})"
                                    class="w-full text-left p-4 rounded-lg shadow-md transition duration-200 
                                    ${isSelected ? 'bg-primary-indigo text-white shadow-xl scale-[1.01]' : 'bg-gray-100 hover:bg-primary-light/30 transform hover:scale-[1.02] active:scale-100'}">
                                    <span class="font-medium ${isSelected ? 'text-white' : 'text-gray-800'}">${option}</span>
                                    ${isSelected ? '<span class="float-right text-lg">âœ…</span>' : ''}
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div class="pt-4 border-t border-gray-200 text-sm text-gray-500 flex justify-between items-center mb-8">
                    <span>ç•¶å‰é¡Œè™Ÿ: ${currentQIndex + 1} / ${questions.length} é¡Œ (${totalAnswered} é¡Œå·²ä½œç­”)</span>
                    <div class="flex space-x-3">
                        <button onclick="goPrev('${quizType}')" 
                            class="flex items-center text-primary-indigo hover:text-primary-light transition duration-150 p-2 rounded-lg 
                            ${currentQIndex === 0 ? 'opacity-50 cursor-not-allowed bg-gray-100' : 'hover:bg-primary-indigo/10'}" 
                            ${currentQIndex === 0 ? 'disabled' : ''}>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            ä¸Šä¸€é¡Œ
                        </button>
                        
                        <button onclick="goNext('${quizType}')" 
                            class="flex items-center text-white bg-primary-indigo transition duration-150 p-2 rounded-lg 
                            ${isNextDisabled ? 'opacity-50 cursor-not-allowed bg-gray-300 text-gray-600' : 'hover:bg-primary-light'}" 
                            ${isNextDisabled ? 'disabled' : ''}>
                            ${nextButtonText}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                ${getRealAdHtml()} `; // æ¸¬é©—é é¢åº•éƒ¨ä½¿ç”¨é€šç”¨ AdSense ID
        }
        
        // --- è™•ç†ç­”æ¡ˆæäº¤å’Œå°èˆª (ç„¡ä¿®æ”¹) ---
        function submitAnswer(quizType, answerIndex) {
            const data = getQuizData(quizType);
            const answers = data.answers;
            let currentQIndex = data.index;

            answers[currentQIndex] = answerIndex;

            if (currentQIndex < getAnsweredCount(answers) - 1) {
                renderTabContent();
                return;
            }

            if (currentQIndex < data.count - 1) {
                setQuizIndex(quizType, currentQIndex + 1);
            } 
            renderTabContent();
        }

        function goNext(quizType) {
            const data = getQuizData(quizType);
            let currentQIndex = data.index;
            const totalAnswered = getAnsweredCount(data.answers);

            if (currentQIndex < data.count - 1 && currentQIndex < totalAnswered) {
                setQuizIndex(quizType, currentQIndex + 1);
            } else if (currentQIndex === data.count - 1 && totalAnswered === data.count) {
                setQuizIndex(quizType, data.count); 
            }
            renderTabContent();
        }

        function goPrev(quizType) {
            const data = getQuizData(quizType);
            let currentQIndex = data.index;

            if (currentQIndex > 0) {
                setQuizIndex(quizType, currentQIndex - 1);
                renderTabContent();
            }
        }
        
        // -----------------------------------------------------------
        // ä¿®æ”¹ renderLockedContent å‡½æ•¸ (ä½¿ç”¨ç¬¬ä¸‰æ–¹å»£å‘Š + Ad-Blocker æª¢æŸ¥)
        // -----------------------------------------------------------
        function renderLockedContent(tabName, targetTabId) {
            const unlockTarget = targetTabId === 'tab2' ? 'expert' : 'pro';
            const unlockText = targetTabId === 'tab2' ? 'å°ˆå®¶æ¸¬é©— (69 é¡Œ)' : 'ç²¾æº– Pro (120 é¡Œ)';
            
            // æ ¹æ“šè§£é–ç›®æ¨™ï¼Œæ±ºå®šä½¿ç”¨å“ªå€‹ç¬¬ä¸‰æ–¹å»£å‘Šè…³æœ¬
            const thirdPartyAdHtml = (targetTabId === 'tab2') ? getThirdPartyAd1() : getThirdPartyAd2();

            if (isAdBlockerActive) {
                 return `
                    <div class="text-center p-8 bg-red-100 rounded-xl border-4 border-dashed border-red-500">
                        <p class="text-2xl font-bold text-red-700 mb-4">
                            ğŸš« å»£å‘Šé˜»æ“‹å™¨åµæ¸¬ï¼
                        </p>
                        <p class="text-gray-700 mb-6">
                            åµæ¸¬åˆ°æ‚¨å•Ÿç”¨äº†å»å»£å‘Šè»Ÿé«”ã€‚ç‚ºäº†ç¶­æŒæœ¬ç«™é‹ä½œï¼Œè«‹é—œé–‰æ‚¨çš„ Ad-Blocker ä¸¦åˆ·æ–°é é¢ï¼Œæ‰èƒ½è§£é–æ­¤é€²éšå…§å®¹ã€‚
                        </p>
                        <button onclick="window.location.reload()"
                            class="px-8 py-3 bg-red-500 text-white font-extrabold rounded-full shadow-lg hover:scale-[1.05]">
                            å·²é—œé–‰é˜»æ“‹å™¨ï¼Œåˆ·æ–°é é¢
                        </button>
                    </div>
                    ${getRealAdHtml('1132687996')} 
                 `;
            }
            
            // æ­£å¸¸é–å®šå…§å®¹
            return `
                <div class="text-center p-8 bg-locked-gray/20 rounded-xl border-4 border-dashed border-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-600 mx-auto mb-4" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0" fill="none"></path>
                        <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3"></path>
                        <path d="M12 10l-2 2l4 4"></path>
                    </svg>
                    <p class="text-xl font-bold text-gray-700 mb-4">
                        æ­¤ç‚º ${tabName}ï¼Œç›®å‰å·²é–å®š ğŸ”’
                    </p>
                    <p class="text-gray-600 mb-6">
                        ç‚ºäº†è´ŠåŠ©ç³»çµ±çš„é‹ä½œï¼Œè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä»¥è§€çœ‹å»£å‘Šï¼ˆæ¨¡æ“¬ï¼‰ï¼Œå³å¯ç«‹å³è§£é–æ­¤é€²éšæ¸¬é©—ï¼
                    </p>
                    <button onclick="startUnlockProcess('${unlockTarget}', this)"
                        class="px-8 py-3 bg-ad-orange text-white font-extrabold rounded-full shadow-lg shadow-ad-orange/50 
                        transition duration-300 transform hover:scale-[1.05] active:scale-100 flex items-center justify-center mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0" fill="none"></path>
                            <path d="M3 10a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path>
                            <path d="M21 21l-6 -6"></path>
                        </svg>
                        é»æ“Šå»£å‘Šç«‹å³è§£é– ${unlockText}
                    </button>
                </div>
                ${thirdPartyAdHtml} 
            `;
        }

        // -----------------------------------------------------------
        // ğŸ›¡ï¸ è™•ç†è§£é–å‰çš„å»¶é² (æ¨¡æ“¬å»£å‘Šè§€çœ‹)
        // -----------------------------------------------------------
        function startUnlockProcess(target, buttonElement) {
            if (isAdBlockerActive) { // ğŸ‘ˆ æ ¸å¿ƒé˜²è­·ï¼šé˜»æ­¢ Ad-Blocker ç”¨æˆ¶é€²å…¥è§£é–æµç¨‹
                showMessageBox("âš ï¸ è«‹å…ˆé—œé–‰å»£å‘Šé˜»æ“‹å™¨ï¼Œå¦å‰‡ç„¡æ³•é€²è¡Œè§£é–ã€‚");
                return;
            }

            // è¨­ç½®é˜²ä½œå¼Šçš„æ™‚é–“æˆ³å’Œç›®æ¨™
            pendingUnlockTarget = target;
            pendingUnlockTimestamp = Date.now();
            
            // ç¦ç”¨æŒ‰éˆ•ä¸¦é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            buttonElement.disabled = true;
            buttonElement.innerHTML = 'æ­£åœ¨è¼‰å…¥å»£å‘Šï¼Œè«‹ç¨å€™... (3 ç§’)';
            buttonElement.classList.add('bg-gray-400');
            buttonElement.classList.remove('bg-ad-orange', 'shadow-ad-orange/50');


            // æ¨¡æ“¬å»£å‘Šè§€çœ‹å»¶é²
            setTimeout(() => {
                // åŸ·è¡ŒçœŸæ­£çš„è§£é–é‚è¼¯ (å¸¶æœ‰é˜²ä½œå¼Šæª¢æŸ¥)
                unlockTab(target);
                
                // ç„¡è«–æˆåŠŸèˆ‡å¦ï¼Œé‡ç½®æŒ‰éˆ•ç‹€æ…‹ (å¦‚æœå…ƒç´ é‚„å­˜åœ¨çš„è©±)
                const unlockText = (target === 'expert') ? 'å°ˆå®¶æ¸¬é©— (69 é¡Œ)' : 'ç²¾æº– Pro (120 é¡Œ)';
                
                // æª¢æŸ¥æŒ‰éˆ•æ˜¯å¦é‚„åœ¨DOMä¸­ï¼ˆå¯èƒ½å·²ç¶“è·³è½‰é é¢ï¼‰
                const currentButton = document.querySelector(`button[onclick*="startUnlockProcess('${target}')"]`);

                if (currentButton) {
                    currentButton.disabled = false;
                    currentButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0" fill="none"></path><path d="M3 10a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path><path d="M21 21l-6 -6"></path></svg>é»æ“Šå»£å‘Šç«‹å³è§£é– ${unlockText}`;
                    currentButton.classList.add('bg-ad-orange', 'shadow-ad-orange/50');
                    currentButton.classList.remove('bg-gray-400');
                }


            }, UNLOCK_DELAY_MS);

        }

        // -----------------------------------------------------------
        // å»£å‘Šè§£é–é‚è¼¯ (å¢åŠ  Anti-Cheat æª¢æŸ¥)
        // -----------------------------------------------------------
        function unlockTab(target) {
            
            // Anti-Cheat æª¢æŸ¥: ç¢ºä¿å‘¼å«æ˜¯é€é startUnlockProcess å»¶é²å¾Œè§¸ç™¼
            const timeElapsed = Date.now() - pendingUnlockTimestamp;
            
            if (target !== pendingUnlockTarget || timeElapsed < UNLOCK_DELAY_MS - 500) {
                // åªæœ‰åœ¨é‚„æœªè§£é–æ™‚æ‰é€²è¡Œæç¤º
                if ( (target === 'expert' && !isExpertUnlocked) || (target === 'pro' && !isTab3Accessible) ) {
                    console.warn(`Anti-Cheat Warning: Unlock attempt for ${target} failed. Elapsed time: ${timeElapsed}ms.`);
                    showMessageBox("åµæ¸¬åˆ°ç•°å¸¸æ“ä½œã€‚è«‹é€šéé é¢ä¸Šçš„æŒ‰éˆ•æ­£å¸¸è§£é–ï¼ˆæ¨¡æ“¬è§€çœ‹å»£å‘Šï¼‰ï¼Œä¸è¦ç›´æ¥æ“ä½œæ§åˆ¶å°ã€‚");
                }
                
                // æ¸…é™¤ç‹€æ…‹
                pendingUnlockTarget = null;
                pendingUnlockTimestamp = 0;
                return; 
            }

            // -------------------------------------
            // ä»¥ä¸‹æ˜¯åŸä¾†çš„æ­£å¸¸è§£é–é‚è¼¯ 
            // -------------------------------------
            let message = '';
            let targetTabId = '';
            
            if (target === 'expert' && !isExpertUnlocked) {
                isExpertUnlocked = true;
                message = "æ„Ÿè¬æ‚¨çš„æ”¯æŒï¼å°ˆå®¶æ¸¬é©—å·²æˆåŠŸè§£é– ğŸ”“ã€‚é»æ“Šç¢ºèªå¾Œå°‡è‡ªå‹•åˆ‡æ›ã€‚";
                targetTabId = 'tab2';
            } else if (target === 'pro' && !isTab3Accessible) {
                isTab3Accessible = true;
                message = "è´ŠåŠ©å»£å‘Šå·²è§€çœ‹å®Œç•¢ï¼ç²¾æº– Pro æ¸¬é©—å·²æˆåŠŸè§£é– ğŸ”“ã€‚é»æ“Šç¢ºèªå¾Œå°‡è‡ªå‹•åˆ‡æ›ã€‚";
                targetTabId = 'tab3';
            } else {
                message = "æ­¤æ¸¬é©—å·²ç¶“è§£é–éäº†ã€‚";
                targetTabId = (target === 'expert' ? 'tab2' : 'tab3');
            }

            // æ¸…é™¤ç‹€æ…‹
            pendingUnlockTarget = null;
            pendingUnlockTimestamp = 0;

            showMessageBox(message, () => {
                setActiveTab(targetTabId);
            });
        }
        // -----------------------------------------------------------
        
        // --- MBTI çµæœè¨ˆç®—å’Œæ¸²æŸ“ (ä¿æŒä¸è®Š) ---
        const resultDescriptions = {
            'ISTJ': { title: 'ç‰©æµå¸« (Logistician)', desc: 'å‹™å¯¦ã€äº‹å¯¦ç‚ºä¸­å¿ƒï¼Œå¯é æ€§ç„¡èˆ‡å€«æ¯”ã€‚ä»–å€‘æ˜¯å‚³çµ±çš„å®ˆè­·è€…ï¼Œé‡è¦–çµæ§‹å’Œç§©åºã€‚', color: 'text-primary-indigo' },
            'ISFJ': { title: 'å®ˆè¡›è€… (Defender)', desc: 'éå¸¸å¿ èª å’Œé«”è²¼ï¼Œéš¨æ™‚æº–å‚™ä¿è­·æ‰€æ„›çš„äººã€‚ä»–å€‘æ˜¯è¬™éœä¸”å‹¤å¥®çš„åŠ©äººè€…ï¼Œå°‡æœå‹™ä»–äººè¦–ç‚ºè‡ªå·±çš„ä½¿å‘½ã€‚', color: 'text-accent-green' },
            'INFJ': { title: 'æå€¡è€… (Advocate)', desc: 'å®‰éœè€Œç¥ç§˜ï¼Œä½†é¼“èˆäººå¿ƒä¸”ä¸æ‡ˆçš„ç†æƒ³ä¸»ç¾©è€…ã€‚ä»–å€‘æ“æœ‰å¼·çƒˆçš„é“å¾·æ„Ÿå’Œé è¦‹ã€‚', color: 'text-purple-600' },
            'INTJ': { title: 'å»ºç¯‰å¸« (Architect)', desc: 'å¯Œæœ‰æƒ³åƒåŠ›å’Œæˆ°ç•¥æ€æƒ³ï¼Œå°ä¸€åˆ‡éƒ½æœ‰ä¸€å€‹è¨ˆåŠƒã€‚ä»–å€‘æ˜¯çŸ¥è­˜çš„è¿½æ±‚è€…ï¼Œé«˜åº¦ç¨ç«‹ã€‚', color: 'text-red-500' },
            'ISTP': { title: 'æ¢éšªå®¶ (Virtuoso)', desc: 'å¤§è†½è€Œå‹™å¯¦çš„å¯¦é©—è€…ï¼Œæ“…é•·ä½¿ç”¨å·¥å…·å’Œè¦ªæ‰‹è§£æ±ºå•é¡Œã€‚ä»–å€‘å–œæ­¡è‡ªç”±å’Œå³æ™‚çš„è¡Œå‹•ã€‚', color: 'text-blue-500' },
            'ISFP': { title: 'è—è¡“å®¶ (Adventurer)', desc: 'éˆæ´»ã€è¿·äººçš„è—è¡“å®¶ï¼Œéš¨æ™‚æº–å‚™æ¢ç´¢å’Œé«”é©—æ–°äº‹ç‰©ã€‚ä»–å€‘æ´»åœ¨ç•¶ä¸‹ï¼Œé‡è¦–ç¾æ„Ÿã€‚', color: 'text-pink-500' },
            'INFP': { title: 'èª¿åœè€… (Mediator)', desc: 'è©©æ„ã€å–„è‰¯ä¸”ç„¡ç§çš„åˆ©ä»–ä¸»ç¾©è€…ï¼Œç¸½æ˜¯ç†±è¡·æ–¼åŠ©äººã€‚ä»–å€‘ç”±æ ¸å¿ƒåƒ¹å€¼è§€å’Œå¥½å¥‡å¿ƒé©…å‹•ã€‚', color: 'text-teal-500' },
            'INTP': { title: 'é‚è¼¯å­¸å®¶ (Logician)', desc: 'å‰µæ–°è€…ï¼Œå°çŸ¥è­˜æœ‰è‘—æ°¸ä¸æ»¿è¶³çš„æ¸´æœ›ã€‚ä»–å€‘æ“…é•·åˆ†æå’ŒæŠ½è±¡æ€ç¶­ï¼Œäº«å—ç´”ç²¹çš„æ™ºåŠ›æ¢ç´¢ã€‚', color: 'text-yellow-700' },
            'ESTP': { title: 'ä¼æ¥­å®¶ (Entrepreneur)', desc: 'è°æ˜ã€ç²¾åŠ›å……æ²›ï¼ŒçœŸæ­£äº«å—æ´»åœ¨é‚Šç·£ã€‚ä»–å€‘æ˜¯ç¤¾äº¤çš„å¯¦å¹¹å®¶ï¼Œå°ˆæ³¨æ–¼ç•¶å‰çš„çµæœã€‚', color: 'text-orange-600' },
            'ESFP': { title: 'è¡¨æ¼”è€… (Entertainer)', desc: 'è‡ªç™¼æ€§ã€ç²¾åŠ›å……æ²›ä¸”ç†±æƒ…æ´‹æº¢çš„ç”Ÿæ´»å®¶ï¼Œç•¶ä»–å€‘åœ¨å ´æ™‚ï¼Œä¸–ç•Œä¸æœƒæ²‰æ‚¶ã€‚ä»–å€‘å–œæ­¡æˆç‚ºç„¦é»ã€‚', color: 'text-lime-600' },
            'ENFP': { title: 'ç«¶é¸è€… (Campaigner)', desc: 'ç†±æƒ…ã€å¯Œæœ‰å‰µæ„å’Œç¤¾äº¤èƒ½åŠ›ï¼Œæ°¸é èƒ½æ‰¾åˆ°å¾®ç¬‘çš„ç†ç”±ã€‚ä»–å€‘å……æ»¿æ´»åŠ›ï¼Œå°‹æ±‚èˆ‡ä»–äººçš„æ·±åˆ»é€£çµã€‚', color: 'text-indigo-600' },
            'ENTP': { title: 'è¾¯è«–å®¶ (Debater)', desc: 'è°æ˜ä¸”å¥½å¥‡çš„æ€æƒ³å®¶ï¼Œç¸½æ˜¯å¿ä¸ä½å°ç¾ç‹€æå‡ºè³ªç–‘ã€‚ä»–å€‘å–œæ­¡æ™ºåŠ›æŒ‘æˆ°å’Œè…¦åŠ›æ¿€ç›ªã€‚', color: 'text-cyan-600' },
            'ESTJ': { title: 'ç¸½ç¶“ç† (Executive)', desc: 'å„ªç§€çš„ç®¡ç†è€…ï¼Œæ“…é•·ç®¡ç†äº‹å‹™æˆ–äººå“¡ã€‚ä»–å€‘æ˜¯å‚³çµ±çš„å¯¦æ–½è€…ï¼Œé‡è¦–æ•ˆç‡å’Œè²¬ä»»ã€‚', color: 'text-green-700' },
            'ESFJ': { title: 'åŸ·æ”¿å®˜ (Consul)', desc: 'éå¸¸é—œå¿ƒä»–äººï¼Œå–„æ–¼ç¤¾äº¤ï¼Œç†±è¡·æ–¼å¹«åŠ©ã€‚ä»–å€‘æ˜¯åœ˜éšŠçš„åŸºçŸ³ï¼Œé‡è¦–ç¤¾æœƒè¦ç¯„ã€‚', color: 'text-fuchsia-600' },
            'ENFJ': { title: 'ä¸»äººå…¬ (Protagonist)', desc: 'é­…åŠ›åè¶³ã€é¼“èˆäººå¿ƒçš„é ˜å°è€…ï¼Œèƒ½å¤ æ¿€ç™¼è½çœ¾ã€‚ä»–å€‘å¯Œæœ‰æ¿€æƒ…ï¼Œè‡´åŠ›æ–¼å¯¦ç¾ç©æ¥µçš„æ”¹è®Šã€‚', color: 'text-rose-600' },
            'ENTJ': { title: 'æŒ‡æ®å®˜ (Commander)', desc: 'å¤§è†½ã€å¯Œæœ‰æƒ³åƒåŠ›ä¸”æ„å¿—å …å®šçš„é ˜å°è€…ï¼Œä»–å€‘ç¸½èƒ½æ‰¾åˆ°æ–¹æ³•é”æˆç›®æ¨™ã€‚ä»–å€‘æ˜¯å¤©ç”Ÿçš„æ±ºç­–è€…ã€‚', color: 'text-amber-600' }
        };

        function calculateMBTIType(quizType) {
            const data = getQuizData(quizType);
            const answers = data.answers;
            const weight = data.weight; 
            
            const totalAnswered = getAnsweredCount(answers);

            if (totalAnswered === 0) return null;

            const scores = { 'E': 0, 'I': 0, 'S': 0, 'N': 0, 'T': 0, 'F': 0, 'J': 0, 'P': 0 };

            data.questions.forEach((question, questionIndex) => {
                const answerIndex = answers[questionIndex];
                if (answerIndex === 0 || answerIndex === 1) {
                    const dichotomy = question.dichotomy;
                    const char1 = dichotomy.charAt(0);
                    const char2 = dichotomy.charAt(1);
                    
                    if (answerIndex === 0) scores[char1] += 1 * weight;
                    else if (answerIndex === 1) scores[char2] += 1 * weight;
                }
            });

            let resultType = '';
            resultType += (scores['E'] >= scores['I']) ? 'E' : 'I';
            resultType += (scores['S'] >= scores['N']) ? 'S' : 'N';
            resultType += (scores['T'] >= scores['F']) ? 'T' : 'F';
            resultType += (scores['J'] >= scores['P']) ? 'J' : 'P';

            return {
                type: resultType,
                details: {
                    'E_score': scores['E'], 'I_score': scores['I'],
                    'S_score': scores['S'], 'N_score': scores['N'],
                    'T_score': scores['T'], 'F_score': scores['F'],
                    'J_score': scores['J'], 'P_score': scores['P'],
                    totalQuestions: totalAnswered,
                    totalPossible: data.count,
                    level: data.level
                }
            };
        }

        function shareResults(mbtiType, level) {
            const shareText = `æˆ‘åœ¨ã€${level}ã€‘MBTI æ¸¬é©—ä¸­æ¸¬å‡ºçš„çµæœæ˜¯ï¼š${mbtiType} (${resultDescriptions[mbtiType].title})ï¼\n\nå¿«ä¾†æ¸¬æ¸¬ä½ çš„é¡å‹å§ï¼\n${window.location.href}`;

            if (navigator.share) {
                navigator.share({
                    title: `MBTI ${level} æ¸¬é©—çµæœ`,
                    text: shareText,
                    url: window.location.href
                })
                .then(() => showMessageBox('åˆ†äº«æˆåŠŸï¼', () => {}))
                .catch((error) => console.error('Error sharing:', error));
            } else {
                navigator.clipboard.writeText(shareText)
                    .then(() => {
                        showMessageBox(`å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼š\n\n${shareText}`, () => {});
                    })
                    .catch(err => {
                        console.error('Could not copy text: ', err);
                        showMessageBox("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´è‡ªå‹•è¤‡è£½ã€‚è«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹å…§å®¹é€²è¡Œåˆ†äº«ï¼š\n\n" + shareText, () => {});
                    });
            }
        }

        function getDichotomyBar(score1, score2, char1, char2) {
            const total = score1 + score2;
            const percent1 = total > 0 ? Math.round((score1 / total) * 100) : 50;
            const percent2 = 100 - percent1;
            const primaryColor = 'bg-primary-indigo';
            const secondaryColor = 'bg-gray-300';

            return `
                <div class="mb-4">
                    <div class="flex justify-between font-bold text-sm mb-1">
                        <span class="${score1 >= score2 ? 'text-primary-indigo' : 'text-gray-500'}">${char1} (${percent1}%)</span>
                        <span class="${score2 > score1 ? 'text-primary-indigo' : 'text-gray-500'}">${char2} (${percent2}%)</span>
                    </div>
                    <div class="flex h-3 rounded-full overflow-hidden shadow-inner">
                        <div class="${primaryColor} h-full transition-all duration-500 ease-out" style="width: ${percent1}%"></div>
                        <div class="${secondaryColor} h-full transition-all duration-500 ease-out" style="width: ${percent2}%"></div>
                    </div>
                </div>
            `;
        }

        // -----------------------------------------------------------
        // ä¿®æ”¹ renderResults å‡½æ•¸ (ä½¿ç”¨ç¬¬ä¸‰æ–¹å»£å‘Šä½œç‚ºä¿ƒéŠ·ä¸‹ä¸€éšæ®µçš„å»£å‘Š)
        // -----------------------------------------------------------
        function renderResults(quizType) {
            const result = calculateMBTIType(quizType);
            const data = getQuizData(quizType);
            
            if (!result || result.details.totalQuestions !== data.count) {
                 return `<div class="p-8 text-center bg-yellow-100 rounded-xl border border-yellow-500 text-yellow-700 font-bold">éŒ¯èª¤ï¼šè«‹å…ˆå®Œæˆæ‰€æœ‰ ${data.count} é¡Œæ¸¬é©—ï¼Œæ‰èƒ½æŸ¥çœ‹å®Œæ•´çš„å ±å‘Šã€‚</div>`;
            }

            const finalType = result.type;
            const details = result.details;
            const currentResult = resultDescriptions[finalType];
            
            let nextAction;
            let finalAdHtml; 
            
            if (quizType === 'basic' && !isExpertUnlocked) {
                // åŸºæœ¬æ¸¬é©—çµæœé é¢ï¼Œä½¿ç”¨ç¬¬ä¸€å€‹ç¬¬ä¸‰æ–¹å»£å‘Šä¿ƒéŠ·è§£é–å°ˆå®¶æ¸¬é©—
                finalAdHtml = getThirdPartyAd1();
                nextAction = `<button onclick="startUnlockProcess('expert', this)" class="unlock-btn-expert w-full py-3 bg-ad-orange text-white font-extrabold rounded-full shadow-lg hover:scale-[1.02] mt-4">é»æ“Šå»£å‘Šï¼Œè§£é–ä¸‹ä¸€éšæ®µï¼šå°ˆå®¶æ¸¬é©—</button>`;
            } else if (quizType === 'expert' && !isTab3Accessible) {
                // å°ˆå®¶æ¸¬é©—çµæœé é¢ï¼Œä½¿ç”¨ç¬¬äºŒå€‹ç¬¬ä¸‰æ–¹å»£å‘Šä¿ƒéŠ·è§£é– Pro æ¸¬é©—
                finalAdHtml = getThirdPartyAd2();
                nextAction = `<button onclick="startUnlockProcess('pro', this)" class="unlock-btn-pro w-full py-3 bg-ad-orange text-white font-extrabold rounded-full shadow-lg hover:scale-[1.02] mt-4">é»æ“Šå»£å‘Šï¼Œè§£é–æœ€çµ‚éšæ®µï¼šç²¾æº– Pro</button>`;
            } else {
                // æœ€é«˜éšæ®µ (custom) å·²å®Œæˆï¼Œä½¿ç”¨ AdSense é€šç”¨å»£å‘Š
                finalAdHtml = getRealAdHtml('1132687996'); 
                nextAction = `<div class="p-4 bg-accent-green/20 text-accent-green font-bold text-center rounded-lg mt-4">æ­å–œï¼æ‚¨å·²å®Œæˆæ‰€æœ‰æ¸¬é©—ï¼Œé€™æ˜¯æœ€é«˜ç²¾æº–åº¦å ±å‘Šã€‚</div>`;
            }

            const restartButton = `<button onclick="setQuizIndex('${quizType}', 0); renderTabContent();" class="mt-4 text-primary-indigo hover:text-primary-light text-sm font-semibold underline">é‡æ–°æŸ¥çœ‹/ä½œç­”</button>`;
            
            const shareButton = `
                <button onclick="shareResults('${finalType}', '${details.level}')"
                    class="w-full py-3 mt-4 mb-2 bg-accent-green text-white font-extrabold rounded-full shadow-lg hover:scale-[1.02] transition duration-200 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0" fill="none"></path>
                        <path d="M6 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
                        <path d="M18 6m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
                        <path d="M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
                        <path d="M8.7 10.7l6.6 -3.4"></path>
                        <path d="M8.7 13.3l6.6 3.4"></path>
                    </svg>
                    åˆ†äº«æˆ‘çš„ ${details.level} æ¸¬é©—çµæœ
                </button>
            `;


            return `
                <div class="p-4 sm:p-6 bg-accent-green/10 rounded-xl border-4 border-accent-green mb-8 shadow-2xl">
                    <h2 class="text-3xl sm:text-4xl font-extrabold text-accent-green mb-6 border-b-2 border-accent-green pb-3 text-center">
                        ã€${details.level}ã€‘MBTI äººæ ¼ç¸½çµå ±å‘Š
                    </h2>
                    
                    <div class="text-center my-6 bg-white p-6 rounded-lg shadow-xl">
                        <p class="text-xl font-bold text-gray-700 mb-2">æ‚¨ç•¶å‰çš„ç¶œåˆé¡å‹æ˜¯ï¼š</p>
                        <h3 class="text-7xl font-extrabold ${currentResult.color} mb-4">${finalType}</h3>
                        <p class="text-3xl font-semibold text-gray-800">${currentResult.title}</p>
                    </div>
                    
                    
                    <h4 class="text-2xl font-bold text-gray-700 mb-4 mt-8 border-b pb-2">ã€æ€§æ ¼æ ¸å¿ƒæè¿°ã€‘</h4>
                    <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-primary-indigo mb-6">
                        <p class="text-gray-600 leading-relaxed text-lg font-medium">
                            ${currentResult.desc}
                        </p>
                    </div>

                    <h4 class="text-2xl font-bold text-gray-700 mb-4 mt-8 border-b pb-2">ã€å››å¤§ç¶­åº¦å‚¾å‘åˆ†æã€‘</h4>
                    
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        ${getDichotomyBar(details.E_score, details.I_score, 'E (å¤–å‘)', 'I (å…§å‘)')}
                        ${getDichotomyBar(details.S_score, details.N_score, 'S (å¯¦æ„Ÿ)', 'N (ç›´è¦º)')}
                        ${getDichotomyBar(details.T_score, details.F_score, 'T (æ€è€ƒ)', 'F (æƒ…æ„Ÿ)')}
                        ${getDichotomyBar(details.J_score, details.P_score, 'J (åˆ¤æ–·)', 'P (æ„ŸçŸ¥)')}
                    </div>
                    
                    <p class="text-xs text-gray-400 mt-6 text-center">æ­¤å ±å‘ŠåŸºæ–¼æ‚¨å·²å®Œæˆçš„ ${details.totalQuestions} é¡Œæ¸¬é©—ã€‚${restartButton}</p>
                    
                    ${shareButton}
                    ${nextAction}

                </div>
                ${finalAdHtml} `; 
        }

        // --- æ ¸å¿ƒå°èˆªå’Œç‹€æ…‹ç®¡ç† (ç„¡ä¿®æ”¹) ---
        function setActiveTab(tabId) {
            let targetTab = tabId;

            if (tabId === 'tab2' && !isExpertUnlocked) {
                targetTab = 'tab2';
            } else if (tabId === 'tab3' && !isTab3Accessible) {
                targetTab = 'tab3';
            }
            
            activeTab = targetTab;

            let quizType;
            if (activeTab === 'tab1') quizType = 'basic';
            else if (activeTab === 'tab2') quizType = 'expert';
            else if (activeTab === 'tab3') quizType = 'custom';
            else return; 

            const quizData = getQuizData(quizType);
            const totalAnswered = getAnsweredCount(quizData.answers);
            
            setQuizIndex(quizType, totalAnswered);

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-primary-indigo', 'text-white');
                btn.classList.add('text-gray-500', 'hover:bg-primary-light/20');
            });

            const currentBtn = document.getElementById(activeTab);
            if (currentBtn) {
                currentBtn.classList.add('bg-primary-indigo', 'text-white');
                currentBtn.classList.remove('text-gray-500', 'hover:bg-primary-light/20');
            }

            renderTabContent();
        }
        
        // --- é é¢å•Ÿå‹•åˆå§‹åŒ– (ç§»é™¤å•Ÿå‹•æ™‚å½ˆçª—) ---
        document.addEventListener('DOMContentLoaded', (event) => {
            // ç”±æ–¼ Ad-Blocker åµæ¸¬éœ€è¦æ™‚é–“ï¼Œå…ˆåŸ·è¡Œå®ƒ
            checkAdBlocker(); 
            setActiveTab('tab1');
            
            // âš ï¸ å·²ç§»é™¤å•Ÿå‹•æ™‚çš„è­¦å‘Šå½ˆçª—ï¼Œåªåœ¨ç”¨æˆ¶å˜—è©¦è§£é–æ™‚è§¸ç™¼æª¢æŸ¥ã€‚
        });

    </script>
</body>

</html>
