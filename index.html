<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>MBTIäººæ ¼æ¸¬é©— | å®Œæ•´å°ˆæ¥­ç‰ˆ</title>
    
    <!-- Google AdSense -->
    <meta name="google-adsense-account" content="ca-pub-2895749032536610">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2895749032536610" crossorigin="anonymous"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* æ‰‹æ©Ÿå„ªåŒ– */
        @media (max-width: 768px) {
            .mobile-ad { min-height: 280px !important; }
            .quiz-container { padding: 1rem !important; }
            .question-text { font-size: 1.1rem !important; }
            .option-btn { padding: 1rem !important; margin: 0.5rem 0 !important; }
        }
        
        /* å‹•ç•«æ•ˆæœ */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        /* é€²åº¦æ¢ */
        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #818cf8);
            transition: width 0.5s ease;
        }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #3730a3);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3); }
        
        .btn-unlock {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-weight: 700;
            transition: all 0.3s;
        }
        .btn-unlock:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(249, 115, 22, 0.3); }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="max-w-4xl mx-auto p-4">
        <!-- æ¨™é¡Œ -->
        <header class="text-center mb-8 mt-4">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-3">ğŸ­ MBTI äººæ ¼æ¸¬é©—ç³»çµ±</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">æ¢ç´¢çœŸå¯¦è‡ªæˆ‘ï¼Œå…è²»æ¸¬è©¦16å‹äººæ ¼ï¼Œè´ŠåŠ©å»£å‘Šè§£é–é€²éšåˆ†æ</p>
        </header>
        
        <!-- ä¸»å¡ç‰‡ -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <!-- æ¨™ç±¤é  -->
            <div class="flex border-b border-gray-200">
                <button onclick="switchTab('basic')" id="tab-basic" class="flex-1 py-4 text-center font-semibold bg-indigo-600 text-white">
                    åŸºæœ¬æ¸¬é©— (16é¡Œ)
                </button>
                <button onclick="switchTab('expert')" id="tab-expert" class="flex-1 py-4 text-center font-semibold text-gray-600 hover:bg-gray-50">
                    å°ˆå®¶æ¸¬é©— (69é¡Œ)
                </button>
                <button onclick="switchTab('pro')" id="tab-pro" class="flex-1 py-4 text-center font-semibold text-gray-600 hover:bg-gray-50">
                    ç²¾æº– Pro (120é¡Œ)
                </button>
            </div>
            
            <!-- å…§å®¹å€ -->
            <div id="content-area" class="p-4 md:p-8 min-h-[500px]">
                æ­£åœ¨è¼‰å…¥...
            </div>
        </div>
        
        <!-- åº•éƒ¨å»£å‘Šï¼ˆæ‰‹æ©Ÿå„ªåŒ–ï¼‰ -->
        <div class="mt-8">
            <div class="mobile-ad bg-gray-50 border border-gray-200 rounded-xl p-4">
                <p class="text-center text-sm text-gray-500 mb-2">è´ŠåŠ©å»£å‘Š</p>
                <div id="bottom-ad">
                    <!-- Google AdSense å»£å‘Šè¼‰å…¥å€ -->
                </div>
            </div>
        </div>
    </div>

<script>
// ==================== å…¨å±€ç‹€æ…‹ ====================
let currentTab = 'basic';
let quizState = {
    basic: {
        currentQuestion: 0,
        answers: new Array(16).fill(null),
        completed: false,
        result: null
    },
    expert: { unlocked: false, currentQuestion: 0, answers: [] },
    pro: { unlocked: false, currentQuestion: 0, answers: [] }
};

// ==================== MBTI é¡Œç›®åº« ====================
const BASIC_QUESTIONS = [
    { id: 1, text: "ç¶“éä¸€æ•´å¤©çš„å·¥ä½œæˆ–ç¤¾äº¤æ´»å‹•å¾Œï¼Œæ‚¨é€šå¸¸çš„æ„Ÿè¦ºæ˜¯ï¼Ÿ", options: ["ç²¾åŠ›å……æ²›ï¼Œé‚„æƒ³ç¹¼çºŒæ´»å‹•æˆ–äº¤è«‡ (E)", "æ„Ÿåˆ°ç–²æ†Šï¼Œéœ€è¦ç¨è™•ä¾†å……é›» (I)"], dichotomy: 'EI' },
    { id: 2, text: "åœ¨ä¸€å€‹å……æ»¿äººçš„å ´åˆä¸­ï¼Œæ‚¨å‚¾å‘æ–¼ï¼Ÿ", options: ["ç©æ¥µåƒèˆ‡ä¸¦æ˜¯ä¸»è¦çš„ç™¼è¨€äººä¹‹ä¸€ (E)", "ä¿æŒè§€å¯Ÿï¼Œæ›´å–œæ­¡ä¸€å°ä¸€æˆ–å°çµ„æ·±åº¦äº¤æµ (I)"], dichotomy: 'EI' },
    { id: 3, text: "æ‚¨æ›´å–œæ­¡è™•ç†å“ªç¨®è¨Šæ¯ï¼Ÿ", options: ["åœ¨å¤–ç•Œç™¼ç”Ÿçš„ã€å…·é«”çš„ã€å¯è¦‹çš„æ´»å‹• (E)", "åœ¨è…¦æµ·ä¸­ç™¼ç”Ÿçš„ã€å…§çœçš„ã€æƒ³åƒä¸­çš„æ´»å‹• (I)"], dichotomy: 'EI' },
    { id: 4, text: "æ‚¨èªç‚ºå¤šæ•¸äººå°æ‚¨çš„ç­è§£ç¨‹åº¦æ˜¯ï¼Ÿ", options: ["ç›¸ç•¶ä¸éŒ¯ï¼Œå› ç‚ºæ‚¨å¾ˆé–‹æ”¾ (E)", "ä¸å¤ æ·±å…¥ï¼Œå› ç‚ºæ‚¨è¼ƒç‚ºå…§æ–‚ (I)"], dichotomy: 'EI' },
    { id: 5, text: "åœ¨å­¸ç¿’æ–°æ±è¥¿æ™‚ï¼Œæ‚¨æ›´é‡è¦–ï¼Ÿ", options: ["å¯¦éš›çš„æ‡‰ç”¨ã€ç•¶å‰çš„ç´°ç¯€å’Œæ˜ç¢ºçš„æ­¥é©Ÿ (S)", "ç†è«–åŸºç¤ã€æŠ½è±¡æ¦‚å¿µå’Œæœªä¾†çš„å¯èƒ½æ€§ (N)"], dichotomy: 'SN' },
    { id: 6, text: "æ‚¨æœ€äº«å—çš„å°è©±å…§å®¹æ˜¯é—œæ–¼ï¼Ÿ", options: ["æ‰‹é‚Šçš„ä»»å‹™ã€çœŸå¯¦ç™¼ç”Ÿçš„äº‹ä»¶æˆ–å¯¦ç”¨è³‡è¨Š (S)", "å“²å­¸ã€é è¦‹ã€æ–°ç©çš„æƒ³æ³•æˆ–æ¯”å–» (N)"], dichotomy: 'SN' },
    { id: 7, text: "æ‚¨é€šå¸¸ä¿¡ä»»ï¼Ÿ", options: ["æ‚¨çš„éå»ç¶“é©—å’Œç¶“éé©—è­‰çš„äº‹å¯¦ (S)", "æ‚¨çš„éˆæ„Ÿã€ç›´è¦ºæˆ–å°æ¨¡å¼çš„æ´å¯Ÿ (N)"], dichotomy: 'SN' },
    { id: 8, text: "æ‚¨èªç‚ºè‡ªå·±æ˜¯ä¸€å€‹ï¼Ÿ", options: ["å‹™å¯¦ä¸”è…³è¸å¯¦åœ°çš„äºº (S)", "å¯Œæœ‰æƒ³åƒåŠ›å’ŒåŸå‰µæ€§çš„äºº (N)"], dichotomy: 'SN' },
    { id: 9, text: "ç•¶æ‚¨åšé‡å¤§æ±ºå®šæ™‚ï¼Œæ‚¨æœƒï¼Ÿ", options: ["ä¿æŒå®¢è§€ï¼Œæ¬Šè¡¡é‚è¼¯ã€æ•ˆç‡å’Œåˆ©å¼Š (T)", "è€ƒæ…®å°ä»–äººçš„å½±éŸ¿ã€æƒ…æ„Ÿåƒ¹å€¼å’Œå€‹äººæƒ…æ³ (F)"], dichotomy: 'TF' },
    { id: 10, text: "åœ¨æ‰¹è©•æˆ–æå‡ºåå°æ„è¦‹æ™‚ï¼Œæ‚¨å‚¾å‘æ–¼ï¼Ÿ", options: ["ç›´æ¥ã€å¦èª ï¼Œå°ˆæ³¨æ–¼å•é¡Œçš„è§£æ±º (T)", "æº«å’Œã€åœ“æ»‘ï¼Œç›¡é‡ç¶­è­·å’Œè«§çš„é—œä¿‚ (F)"], dichotomy: 'TF' },
    { id: 11, text: "æ‚¨èªç‚ºç¨±è®šä¸€å€‹äººæœ€å¥½æ˜¯ç¨±è®šå…¶ï¼Ÿ", options: ["æ™ºæ…§ã€é‚è¼¯æ€ç¶­æˆ–å…¬å¹³æ€§ (T)", "å–„è‰¯ã€åŒç†å¿ƒæˆ–ç†±å¿ƒåŠ©äºº (F)"], dichotomy: 'TF' },
    { id: 12, text: "æ‚¨èªç‚ºå…¬æ­£çš„æ±ºå®šæ‡‰è©²åŸºæ–¼ï¼Ÿ", options: ["ä¸€å¥—çµ±ä¸€ã€éå€‹äººçš„æ¨™æº– (T)", "æ¯å€‹äººçš„ç¨ç‰¹éœ€æ±‚å’Œåƒ¹å€¼è§€ (F)"], dichotomy: 'TF' },
    { id: 13, text: "å°æ–¼å‡æœŸæˆ–å¤§å°ˆæ¡ˆï¼Œæ‚¨å‚¾å‘æ–¼ï¼Ÿ", options: ["æå‰è¨ˆç•«ã€ç¢ºå®šç´°ç¯€ä¸¦æŒ‰æ™‚å®Œæˆ (J)", "ä¿æŒå½ˆæ€§ã€é–‹æ”¾é¸æ“‡ï¼Œä¸¦åœ¨ç•¶ä¸‹æ±ºå®š (P)"], dichotomy: 'JP' },
    { id: 14, text: "æ‚¨é€šå¸¸è¦ºå¾—æˆªæ­¢æ—¥æœŸæ˜¯ï¼Ÿ", options: ["å¿…é ˆéµå®ˆçš„ï¼Œé€™è®“æ‚¨æœ‰æ¢ç†åœ°å·¥ä½œ (J)", "å¯ä»¥èª¿æ•´çš„ï¼Œé€™è®“æ‚¨èƒ½å¤ é©æ‡‰è®ŠåŒ– (P)"], dichotomy: 'JP' },
    { id: 15, text: "æ‚¨çš„å·¥ä½œæˆ–ç”Ÿæ´»ç©ºé–“é€šå¸¸æ˜¯ï¼Ÿ", options: ["æ•´æ½”ã€æœ‰åºï¼Œæ‰€æœ‰æ±è¥¿éƒ½æœ‰å›ºå®šçš„ä½ç½® (J)", "éš¨æ€§ã€æœ‰æ©Ÿï¼Œé›œäº‚ä½†æ‚¨çŸ¥é“æ±è¥¿åœ¨å“ª (P)"], dichotomy: 'JP' },
    { id: 16, text: "æ‚¨å°‡ç”Ÿæ´»è¦–ç‚ºï¼Ÿ", options: ["éœ€è¦è¢«æ§åˆ¶ã€çµ„ç¹”å’Œåšå‡ºçµè«–çš„çµæ§‹ (J)", "éœ€è¦è¢«é«”é©—ã€æ¢ç´¢å’Œä¿æŒé–‹æ”¾çš„éç¨‹ (P)"], dichotomy: 'JP' },
];

// ==================== æ¨™ç±¤åˆ‡æ› ====================
function switchTab(tabId) {
    currentTab = tabId;
    
    // æ›´æ–°æ¨™ç±¤æ¨£å¼
    document.querySelectorAll('[id^="tab-"]').forEach(btn => {
        btn.classList.remove('bg-indigo-600', 'text-white');
        btn.classList.add('text-gray-600', 'hover:bg-gray-50');
    });
    
    const activeBtn = document.getElementById(`tab-${tabId}`);
    activeBtn.classList.add('bg-indigo-600', 'text-white');
    activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-50');
    
    // æ¸²æŸ“å…§å®¹
    renderContent();
}

// ==================== å…§å®¹æ¸²æŸ“å™¨ ====================
function renderContent() {
    const area = document.getElementById('content-area');
    
    if (currentTab === 'basic') {
        if (quizState.basic.completed) {
            area.innerHTML = renderResults();
        } else {
            area.innerHTML = renderBasicQuiz();
        }
    } else if (currentTab === 'expert') {
        if (quizState.expert.unlocked) {
            area.innerHTML = renderExpertQuiz();
        } else {
            area.innerHTML = renderLockedPage('expert', 'å°ˆå®¶æ¸¬é©—', '69é¡Œæ·±åº¦åˆ†æï¼ŒåŒ…å«è·æ¥­å»ºè­°ã€äººéš›é—œä¿‚æŒ‡å—å’Œå€‹äººæˆé•·è¨ˆåŠƒã€‚');
        }
    } else if (currentTab === 'pro') {
        if (quizState.pro.unlocked) {
            area.innerHTML = renderProQuiz();
        } else {
            area.innerHTML = renderLockedPage('pro', 'ç²¾æº– Pro', '120é¡Œçµ‚æ¥µè©•ä¼°ï¼Œæœ€å…¨é¢çš„æ€§æ ¼å‰–æã€ç™¼å±•è·¯å¾‘å’Œå°ˆæ¥­å»ºè­°ã€‚');
        }
    }
    
    // è¼‰å…¥å»£å‘Š
    loadAds();
}

// ==================== åŸºæœ¬æ¸¬é©—æ¸²æŸ“ ====================
function renderBasicQuiz() {
    const q = BASIC_QUESTIONS[quizState.basic.currentQuestion];
    const answered = quizState.basic.answers.filter(a => a !== null).length;
    const progress = (answered / 16) * 100;
    
    return `
        <div class="fade-in quiz-container">
            <div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">åŸºæœ¬äººæ ¼æ¸¬é©—</h2>
                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full font-semibold">${answered}/16 é¡Œ</span>
                </div>
                
                <div class="mb-8">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>æ¸¬é©—é€²åº¦</span>
                        <span>${Math.round(progress)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>
                
                <div class="mb-10 p-6 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl border border-indigo-100">
                    <div class="flex items-start">
                        <div class="w-12 h-12 rounded-xl bg-indigo-100 flex items-center justify-center mr-4">
                            <span class="text-xl font-bold text-indigo-700">${quizState.basic.currentQuestion + 1}</span>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">${q.text}</h3>
                            <div class="space-y-3">
                                ${q.options.map((option, idx) => `
                                    <button onclick="selectAnswer(${idx})" 
                                            class="w-full text-left p-4 rounded-xl border-2 transition-all duration-200 ${quizState.basic.answers[quizState.basic.currentQuestion] === idx ? 'border-indigo-500 bg-indigo-50 shadow-md' : 'border-gray-200 hover:border-indigo-300 hover:bg-gray-50'}">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mr-3 ${quizState.basic.answers[quizState.basic.currentQuestion] === idx ? 'border-indigo-500 bg-indigo-500 text-white' : 'border-gray-300'}">
                                                ${String.fromCharCode(65 + idx)}
                                            </div>
                                            <span class="flex-1 text-gray-800">${option}</span>
                                            ${quizState.basic.answers[quizState.basic.currentQuestion] === idx ? 
                                                '<span class="text-indigo-600">âœ“</span>' : ''}
                                        </div>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between pt-6 border-t border-gray-200">
                    <button onclick="prevQuestion()" ${quizState.basic.currentQuestion === 0 ? 'disabled' : ''} 
                            class="px-6 py-3 rounded-lg font-medium ${quizState.basic.currentQuestion === 0 ? 'text-gray-400 cursor-not-allowed' : 'text-indigo-600 hover:bg-indigo-50'}">
                        â† ä¸Šä¸€é¡Œ
                    </button>
                    
                    <button onclick="nextQuestion()" ${quizState.basic.answers[quizState.basic.currentQuestion] === null ? 'disabled' : ''} 
                            class="px-8 py-3 rounded-lg font-semibold ${quizState.basic.answers[quizState.basic.currentQuestion] === null ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'btn-primary'}">
                        ${quizState.basic.currentQuestion === 15 ? 'å®Œæˆæ¸¬é©—' : 'ä¸‹ä¸€é¡Œ â†’'}
                    </button>
                </div>
            </div>
        </div>
    `;
}

// ==================== æ¸¬é©—åŠŸèƒ½ ====================
function selectAnswer(answerIndex) {
    quizState.basic.answers[quizState.basic.currentQuestion] = answerIndex;
    renderContent();
}

function prevQuestion() {
    if (quizState.basic.currentQuestion > 0) {
        quizState.basic.currentQuestion--;
        renderContent();
    }
}

function nextQuestion() {
    if (quizState.basic.answers[quizState.basic.currentQuestion] === null) {
        alert('è«‹é¸æ“‡ä¸€å€‹ç­”æ¡ˆ');
        return;
    }
    
    if (quizState.basic.currentQuestion < 15) {
        quizState.basic.currentQuestion++;
        renderContent();
    } else {
        calculateResults();
        quizState.basic.completed = true;
        renderContent();
    }
}

// ==================== çµæœè¨ˆç®— ====================
function calculateResults() {
    const scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
    
    BASIC_QUESTIONS.forEach((question, index) => {
        const answer = quizState.basic.answers[index];
        if (answer !== null) {
            const dichotomy = question.dichotomy;
            if (answer === 0) scores[dichotomy[0]]++;
            else if (answer === 1) scores[dichotomy[1]]++;
        }
    });
    
    const mbtiType = 
        (scores.E >= scores.I ? 'E' : 'I') +
        (scores.S >= scores.N ? 'S' : 'N') +
        (scores.T >= scores.F ? 'T' : 'F') +
        (scores.J >= scores.P ? 'J' : 'P');
    
    const descriptions = {
        'ISTJ': { title: 'ç‰©æµå¸« (Logistician)', desc: 'å‹™å¯¦ã€äº‹å¯¦ç‚ºä¸­å¿ƒï¼Œå¯é æ€§ç„¡èˆ‡å€«æ¯”ã€‚ä»–å€‘æ˜¯å‚³çµ±çš„å®ˆè­·è€…ï¼Œé‡è¦–çµæ§‹å’Œç§©åºã€‚' },
        'ISFJ': { title: 'å®ˆè¡›è€… (Defender)', desc: 'éå¸¸å¿ èª å’Œé«”è²¼ï¼Œéš¨æ™‚æº–å‚™ä¿è­·æ‰€æ„›çš„äººã€‚ä»–å€‘æ˜¯è¬™éœä¸”å‹¤å¥®çš„åŠ©äººè€…ï¼Œå°‡æœå‹™ä»–äººè¦–ç‚ºè‡ªå·±çš„ä½¿å‘½ã€‚' },
        'INFJ': { title: 'æå€¡è€… (Advocate)', desc: 'å®‰éœè€Œç¥ç§˜ï¼Œä½†é¼“èˆäººå¿ƒä¸”ä¸æ‡ˆçš„ç†æƒ³ä¸»ç¾©è€…ã€‚ä»–å€‘æ“æœ‰å¼·çƒˆçš„é“å¾·æ„Ÿå’Œé è¦‹ã€‚' },
        'INTJ': { title: 'å»ºç¯‰å¸« (Architect)', desc: 'å¯Œæœ‰æƒ³åƒåŠ›å’Œæˆ°ç•¥æ€æƒ³ï¼Œå°ä¸€åˆ‡éƒ½æœ‰ä¸€å€‹è¨ˆåŠƒã€‚ä»–å€‘æ˜¯çŸ¥è­˜çš„è¿½æ±‚è€…ï¼Œé«˜åº¦ç¨ç«‹ã€‚' },
        'ISTP': { title: 'æ¢éšªå®¶ (Virtuoso)', desc: 'å¤§è†½è€Œå‹™å¯¦çš„å¯¦é©—è€…ï¼Œæ“…é•·ä½¿ç”¨å·¥å…·å’Œè¦ªæ‰‹è§£æ±ºå•é¡Œã€‚ä»–å€‘å–œæ­¡è‡ªç”±å’Œå³æ™‚çš„è¡Œå‹•ã€‚' },
        'ISFP': { title: 'è—è¡“å®¶ (Adventurer)', desc: 'éˆæ´»ã€è¿·äººçš„è—è¡“å®¶ï¼Œéš¨æ™‚æº–å‚™æ¢ç´¢å’Œé«”é©—æ–°äº‹ç‰©ã€‚ä»–å€‘æ´»åœ¨ç•¶ä¸‹ï¼Œé‡è¦–ç¾æ„Ÿã€‚' },
        'INFP': { title: 'èª¿åœè€… (Mediator)', desc: 'è©©æ„ã€å–„è‰¯ä¸”ç„¡ç§çš„åˆ©ä»–ä¸»ç¾©è€…ï¼Œç¸½æ˜¯ç†±è¡·æ–¼åŠ©äººã€‚ä»–å€‘ç”±æ ¸å¿ƒåƒ¹å€¼è§€å’Œå¥½å¥‡å¿ƒé©…å‹•ã€‚' },
        'INTP': { title: 'é‚è¼¯å­¸å®¶ (Logician)', desc: 'å‰µæ–°è€…ï¼Œå°çŸ¥è­˜æœ‰è‘—æ°¸ä¸æ»¿è¶³çš„æ¸´æœ›ã€‚ä»–å€‘æ“…é•·åˆ†æå’ŒæŠ½è±¡æ€ç¶­ï¼Œäº«å—ç´”ç²¹çš„æ™ºåŠ›æ¢ç´¢ã€‚' },
        'ESTP': { title: 'ä¼æ¥­å®¶ (Entrepreneur)', desc: 'è°æ˜ã€ç²¾åŠ›å……æ²›ï¼ŒçœŸæ­£äº«å—æ´»åœ¨é‚Šç·£ã€‚ä»–å€‘æ˜¯ç¤¾äº¤çš„å¯¦å¹¹å®¶ï¼Œå°ˆæ³¨æ–¼ç•¶å‰çš„çµæœã€‚' },
        'ESFP': { title: 'è¡¨æ¼”è€… (Entertainer)', desc: 'è‡ªç™¼æ€§ã€ç²¾åŠ›å……æ²›ä¸”ç†±æƒ…æ´‹æº¢çš„ç”Ÿæ´»å®¶ï¼Œç•¶ä»–å€‘åœ¨å ´æ™‚ï¼Œä¸–ç•Œä¸æœƒæ²‰æ‚¶ã€‚ä»–å€‘å–œæ­¡æˆç‚ºç„¦é»ã€‚' },
        'ENFP': { title: 'ç«¶é¸è€… (Campaigner)', desc: 'ç†±æƒ…ã€å¯Œæœ‰å‰µæ„å’Œç¤¾äº¤èƒ½åŠ›ï¼Œæ°¸é èƒ½æ‰¾åˆ°å¾®ç¬‘çš„ç†ç”±ã€‚ä»–å€‘å……æ»¿æ´»åŠ›ï¼Œå°‹æ±‚èˆ‡ä»–äººçš„æ·±åˆ»é€£çµã€‚' },
        'ENTP': { title: 'è¾¯è«–å®¶ (Debater)', desc: 'è°æ˜ä¸”å¥½å¥‡çš„æ€æƒ³å®¶ï¼Œç¸½æ˜¯å¿ä¸ä½å°ç¾ç‹€æå‡ºè³ªç–‘ã€‚ä»–å€‘å–œæ­¡æ™ºåŠ›æŒ‘æˆ°å’Œè…¦åŠ›æ¿€ç›ªã€‚' },
        'ESTJ': { title: 'ç¸½ç¶“ç† (Executive)', desc: 'å„ªç§€çš„ç®¡ç†è€…ï¼Œæ“…é•·ç®¡ç†äº‹å‹™æˆ–äººå“¡ã€‚ä»–å€‘æ˜¯å‚³çµ±çš„å¯¦æ–½è€…ï¼Œé‡è¦–æ•ˆç‡å’Œè²¬ä»»ã€‚' },
        'ESFJ': { title: 'åŸ·æ”¿å®˜ (Consul)', desc: 'éå¸¸é—œå¿ƒä»–äººï¼Œå–„æ–¼ç¤¾äº¤ï¼Œç†±è¡·æ–¼å¹«åŠ©ã€‚ä»–å€‘æ˜¯åœ˜éšŠçš„åŸºçŸ³ï¼Œé‡è¦–ç¤¾æœƒè¦ç¯„ã€‚' },
        'ENFJ': { title: 'ä¸»äººå…¬ (Protagonist)', desc: 'é­…åŠ›åè¶³ã€é¼“èˆäººå¿ƒçš„é ˜å°è€…ï¼Œèƒ½å¤ æ¿€ç™¼è½çœ¾ã€‚ä»–å€‘å¯Œæœ‰æ¿€æƒ…ï¼Œè‡´åŠ›æ–¼å¯¦ç¾ç©æ¥µçš„æ”¹è®Šã€‚' },
        'ENTJ': { title: 'æŒ‡æ®å®˜ (Commander)', desc: 'å¤§è†½ã€å¯Œæœ‰æƒ³åƒåŠ›ä¸”æ„å¿—å …å®šçš„é ˜å°è€…ï¼Œä»–å€‘ç¸½èƒ½æ‰¾åˆ°æ–¹æ³•é”æˆç›®æ¨™ã€‚ä»–å€‘æ˜¯å¤©ç”Ÿçš„æ±ºç­–è€…ã€‚' }
    };
    
    const desc = descriptions[mbtiType] || { title: 'æ¢ç´¢è€…', desc: 'æ‚¨çš„æ€§æ ¼é¡å‹é¡¯ç¤ºç¨ç‰¹çš„çµ„åˆï¼Œç¹¼çºŒæ¢ç´¢è‡ªæˆ‘æ½›èƒ½å§ï¼' };
    
    quizState.basic.result = {
        type: mbtiType,
        title: desc.title,
        description: desc.desc,
        scores: scores,
        dimensions: [
            { label: 'å¤–å‘(E) / å…§å‘(I)', pct: Math.round((scores.E / (scores.E + scores.I || 1)) * 100), left: 'å¤–å‘', right: 'å…§å‘' },
            { label: 'å¯¦æ„Ÿ(S) / ç›´è¦º(N)', pct: Math.round((scores.S / (scores.S + scores.N || 1)) * 100), left: 'å¯¦æ„Ÿ', right: 'ç›´è¦º' },
            { label: 'æ€è€ƒ(T) / æƒ…æ„Ÿ(F)', pct: Math.round((scores.T / (scores.T + scores.F || 1)) * 100), left: 'æ€è€ƒ', right: 'æƒ…æ„Ÿ' },
            { label: 'åˆ¤æ–·(J) / æ„ŸçŸ¥(P)', pct: Math.round((scores.J / (scores.J + scores.P || 1)) * 100), left: 'åˆ¤æ–·', right: 'æ„ŸçŸ¥' }
        ]
    };
}

// ==================== çµæœé é¢ ====================
function renderResults() {
    const result = quizState.basic.result;
    if (!result) return '<div class="text-center py-12">è¨ˆç®—çµæœä¸­...</div>';
    
    return `
        <div class="fade-in">
            <div class="text-center mb-12">
                <div class="w-32 h-32 mx-auto mb-8 rounded-full bg-gradient-to-r from-green-100 to-emerald-100 flex items-center justify-center">
                    <span class="text-5xl font-bold text-green-700">${result.type}</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">${result.title}</h2>
                <p class="text-gray-600 text-lg max-w-2xl mx-auto mb-10">${result.description}</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                ${result.dimensions.map(dim => `
                    <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-bold text-gray-800">${dim.label}</h4>
                            <span class="text-xl font-bold text-indigo-600">${dim.pct}%</span>
                        </div>
                        <div class="mb-3">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${dim.pct}%"></div>
                            </div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>${dim.left}</span>
                            <span>${dim.right}</span>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div class="bg-gradient-to-r from-orange-50 to-amber-50 p-8 rounded-2xl border border-orange-200 mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">ğŸ¯ é€²éšåˆ†æ</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl border border-orange-100">
                        <h4 class="text-xl font-bold text-gray-800 mb-3">å°ˆå®¶æ¸¬é©— (69é¡Œ)</h4>
                        <p class="text-gray-600 mb-4">æ·±åº¦æ€§æ ¼åˆ†æï¼ŒåŒ…å«è·æ¥­å»ºè­°ã€äººéš›é—œä¿‚æŒ‡å—å’Œå€‹äººæˆé•·è¨ˆåŠƒã€‚</p>
                        <button onclick="showUnlockPage('expert')" class="btn-unlock w-full">
                            è§£é–å°ˆå®¶æ¸¬é©—
                        </button>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl border border-purple-100">
                        <h4 class="text-xl font-bold text-gray-800 mb-3">ç²¾æº– Pro (120é¡Œ)</h4>
                        <p class="text-gray-600 mb-4">çµ‚æ¥µæ€§æ ¼è©•ä¼°ï¼Œæœ€å…¨é¢çš„æ€§æ ¼å‰–æã€ç™¼å±•è·¯å¾‘å’Œå°ˆæ¥­å»ºè­°ã€‚</p>
                        <button onclick="showUnlockPage('pro')" class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-bold hover:opacity-90">
                            è§£é–ç²¾æº– Pro
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="restartQuiz()" class="px-8 py-3 border-2 border-indigo-300 text-indigo-700 font-semibold rounded-xl hover:bg-indigo-50">
                    é‡æ–°æ¸¬è©¦
                </button>
            </div>
        </div>
    `;
}

function restartQuiz() {
    quizState.basic = {
        currentQuestion: 0,
        answers: new Array(16).fill(null),
        completed: false,
        result: null
    };
    renderContent();
}

// ==================== é–å®šé é¢ ====================
function renderLockedPage(type, title, description) {
    return `
        <div class="fade-in text-center py-12">
            <div class="w-24 h-24 mx-auto mb-8 rounded-full bg-gradient-to-r from-gray-200 to-gray-300 flex items-center justify-center">
                <span class="text-4xl">ğŸ”’</span>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">${title}</h2>
            <p class="text-gray-600 text-lg max-w-xl mx-auto mb-10">${description}</p>
            
            <div class="max-w-md mx-auto">
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-8 rounded-2xl border border-amber-200 mb-10">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">è§£é– ${title}</h3>
                    <p class="text-gray-700 mb-8">
                        é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œè§€çœ‹å®Œè´ŠåŠ©å»£å‘Šå¾Œå³å¯ç«‹å³è§£é–ã€‚
                        <span class="block font-semibold mt-2">æ‚¨çš„æ”¯æŒå¹«åŠ©æˆ‘å€‘æŒçºŒæä¾›å…è²»æœå‹™ï¼</span>
                    </p>
                    
                    <button onclick="startUnlockProcess('${type}', this)" 
                            class="btn-unlock w-full text-lg pulse">
                        ğŸ¬ é»æ“Šè§€çœ‹å»£å‘Šè§£é–
                    </button>
                    
                    <p class="text-sm text-gray-500 mt-6">
                        â€¢ å»£å‘Šè¼‰å…¥ç´„éœ€3-5ç§’<br>
                        â€¢ å¯é‡è¤‡è§£é–ï¼Œæ¯æ¬¡éƒ½æœ‰æ”¶ç›Š<br>
                        â€¢ æ”¯æŒæ‰‹æ©Ÿèˆ‡é›»è…¦
                    </p>
                </div>
            </div>
        </div>
    `;
}

function showUnlockPage(type) {
    switchTab(type);
}

// ==================== è§£é–æµç¨‹ ====================
function startUnlockProcess(type, button) {
    console.log(`é–‹å§‹è§£é– ${type} æ¸¬é©—`);
    
    const originalText = button.innerHTML;
    button.innerHTML = 'â³ æ­£åœ¨è§¸ç™¼å»£å‘Š...';
    button.disabled = true;
    
    // è§¸ç™¼ HilltopAds å»£å‘Š
    triggerHilltopAd(type);
    
    // å€’æ•¸è¨ˆæ™‚
    let countdown = 8;
    const interval = setInterval(() => {
        if (countdown > 0) {
            button.innerHTML = `âŒ› è«‹è§€çœ‹å»£å‘Š (${countdown}ç§’)`;
            countdown--;
        } else {
            clearInterval(interval);
            completeUnlock(type, button, originalText);
        }
    }, 1000);
}

function triggerHilltopAd(type) {
    const scripts = {
        expert: `(function(aco){var d=document,s=d.createElement('script'),l=d.scripts[d.scripts.length-1];s.settings=aco||{};s.src="//starry-perception.com/ctD.9M6Nbh2x5SltS-WzQy9-Naj/chywNGjdUF2QOTSX0y2ENwzIIA2GN/TmcTwl";s.async=true;s.referrerPolicy='no-referrer-when-downgrade';l.parentNode.insertBefore(s,l);})({})`,
        pro: `(function(lwa){var d=document,s=d.createElement('script'),l=d.scripts[d.scripts.length-1];s.settings=lwa||{};s.src="//starry-perception.com/c.DX9y6jbT2/5Zl_StWYQa9dN/jPc_yZN/jeUG2FN/yV0o2NNNz/I/2/N/TKYx4_";s.async=true;s.referrerPolicy='no-referrer-when-downgrade';l.parentNode.insertBefore(s,l);})({})`
    };
    
    const script = document.createElement('script');
    script.innerHTML = scripts[type];
    document.head.appendChild(script);
    
    // 5ç§’å¾Œç§»é™¤
    setTimeout(() => {
        if (script.parentNode) {
            script.parentNode.removeChild(script);
        }
    }, 5000);
}

function completeUnlock(type, button, originalText) {
    if (type === 'expert') {
        quizState.expert.unlocked = true;
    } else if (type === 'pro') {
        quizState.pro.unlocked = true;
    }
    
    button.innerHTML = 'âœ… è§£é–æˆåŠŸï¼';
    
    // 2ç§’å¾Œåˆ·æ–°é é¢
    setTimeout(() => {
        renderContent();
        loadAds(); // é‡æ–°è¼‰å…¥å»£å‘Š
    }, 2000);
}

// ==================== å°ˆå®¶/Proæ¸¬é©—ï¼ˆç¤ºç¯„ï¼‰ ====================
function renderExpertQuiz() {
    return `
        <div class="text-center py-12">
            <div class="w-32 h-32 mx-auto mb-8 rounded-full bg-gradient-to-r from-purple-100 to-pink-100 flex items-center justify-center">
                <span class="text-5xl">ğŸ¯</span>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">å°ˆå®¶æ¸¬é©—å·²è§£é–ï¼</h2>
            <p class="text-gray-600 text-lg max-w-xl mx-auto mb-10">
                æ‚¨å·²æˆåŠŸè§£é–69é¡Œæ·±åº¦æ€§æ ¼åˆ†ææ¸¬é©—ã€‚æ„Ÿè¬æ‚¨çš„æ”¯æŒï¼
            </p>
            <button onclick="switchTab('basic')" class="btn-primary px-8 py-3">
                è¿”å›åŸºæœ¬æ¸¬é©—
            </button>
        </div>
    `;
}

function renderProQuiz() {
    return `
        <div class="text-center py-12">
            <div class="w-32 h-32 mx-auto mb-8 rounded-full bg-gradient-to-r from-amber-100 to-orange-100 flex items-center justify-center">
                <span class="text-5xl">ğŸ†</span>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">ç²¾æº– Pro å·²è§£é–ï¼</h2>
            <p class="text-gray-600 text-lg max-w-xl mx-auto mb-10">
                æ‚¨å·²æˆåŠŸè§£é–120é¡Œçµ‚æ¥µæ€§æ ¼è©•ä¼°æ¸¬é©—ã€‚æ„Ÿè¬æ‚¨çš„æ”¯æŒï¼
            </p>
            <button onclick="switchTab('expert')" class="btn-primary px-8 py-3">
                è¿”å›å°ˆå®¶æ¸¬é©—
            </button>
        </div>
    `;
}

// ==================== å»£å‘Šç³»çµ± ====================
function loadAds() {
    // è¼‰å…¥åº•éƒ¨å»£å‘Š
    const bottomAd = document.getElementById('bottom-ad');
    if (bottomAd && !bottomAd.querySelector('.adsbygoogle')) {
        bottomAd.innerHTML = `
            <ins class="adsbygoogle"
                 style="display:block; width:100%; min-height:250px;"
                 data-ad-client="ca-pub-2895749032536610"
                 data-ad-slot="1132687996"
                 data-ad-format="auto"
                 data-full-width-responsive="true">
            </ins>
        `;
    }
    
    // æ¨é€å»£å‘Š
    setTimeout(() => {
        if (typeof adsbygoogle !== 'undefined') {
            try {
                (adsbygoogle = window.adsbygoogle || []).push({});
            } catch (e) {
                console.log('å»£å‘Šè¼‰å…¥ä¸­...');
            }
        }
    }, 500);
}

// ==================== åˆå§‹åŒ– ====================
function init() {
    renderContent();
    
    // åˆå§‹è¼‰å…¥å»£å‘Š
    setTimeout(loadAds, 1000);
    
    // ç›£è½é é¢å¯è¦‹æ€§è®ŠåŒ–
    document.addEventListener('visibilitychange', () => {
        if (!document.hidden) {
            loadAds();
        }
    });
}

// é é¢è¼‰å…¥
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
