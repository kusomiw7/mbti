<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- ==================== ä¸­ç¹¼æ¨™è¨˜ (Meta Tags) ==================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>MBTI äººæ ¼æ¸¬é©— | æ·±åº¦æ¢ç´¢ä½ çš„æ€§æ ¼é¡å‹</title>
    <meta name="description" content="å…è²»é€²è¡Œå°ˆæ¥­çš„MBTIäººæ ¼æ¸¬é©—ï¼ŒåŒ…å«16é¡ŒåŸºæœ¬æ¸¬è©¦ï¼Œä¸¦å¯é€éè´ŠåŠ©å»£å‘Šè§£é–69é¡Œå°ˆå®¶æ¸¬é©—èˆ‡120é¡Œç²¾æº–Proæ¸¬é©—ã€‚">
    <meta name="keywords" content="MBTI, äººæ ¼æ¸¬é©—, æ€§æ ¼æ¸¬è©¦, å¿ƒç†æ¸¬é©—, è·æ¥­è¦åŠƒ, è‡ªæˆ‘æ¢ç´¢">
    <meta name="author" content="MBTI Personality Lab">
    <!-- Google AdSense å¸³æˆ¶è­˜åˆ¥ -->
    <meta name="google-adsense-account" content="ca-pub-2895749032536610">

    <!-- ==================== Google AdSense è‡ªå‹•å»£å‘Š ==================== -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2895749032536610" crossorigin="anonymous"></script>

    <!-- ==================== æ¨£å¼èˆ‡æ¡†æ¶ ==================== -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        :root { --primary: #4F46E5; --secondary: #10B981; --accent: #F97316; }
        * { font-family: 'Inter', sans-serif; }
        body { -webkit-tap-highlight-color: transparent; }
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 640px) {
            .tab-btn { font-size: 0.75rem; padding: 0.75rem 0.5rem; }
            .question-text { font-size: 1.125rem; }
        }
        /* å‹•ç•« */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        .pulse-loading { animation: pulse 1.5s ease-in-out infinite; }
        /* å»£å‘Šå®¹å™¨ */
        .ad-slot { min-height: 100px; background-color: #f8fafc; border: 1px dashed #cbd5e1; }
        .unlock-ad-label { font-size: 0.75rem; color: #6b7280; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div id="app" class="max-w-4xl mx-auto p-4">
        <!-- é é¦– -->
        <header class="text-center mb-8 pt-4">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">ğŸ”® MBTI äººæ ¼æ·±åº¦æ¸¬é©—</h1>
            <p class="text-gray-600">å®ŒæˆåŸºæœ¬æ¸¬é©—å¾Œï¼Œå¯é€éè´ŠåŠ©å»£å‘Šè§£é–æ›´é€²éšçš„åˆ†æå ±å‘Šã€‚</p>
        </header>

        <!-- ä¸»å¡ç‰‡ -->
        <main class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
            <!-- å°èˆªæ¨™ç±¤ -->
            <div class="flex border-b border-gray-200 bg-gray-50">
                <button id="tab-basic" onclick="switchTab('basic')" class="tab-btn flex-1 py-4 font-semibold bg-primary text-white">
                    <div>åŸºæœ¬æ¸¬é©—</div><div class="text-xs opacity-90">16é¡Œå¿«é€Ÿæ¸¬è©¦</div>
                </button>
                <button id="tab-expert" onclick="switchTab('expert')" class="tab-btn flex-1 py-4 font-semibold text-gray-600 hover:bg-gray-100">
                    <div>å°ˆå®¶æ¸¬é©—</div><div class="text-xs opacity-80">69é¡Œæ·±åº¦åˆ†æ</div><div id="expert-lock" class="text-xs text-red-500">ğŸ”’ éœ€è§£é–</div>
                </button>
                <button id="tab-pro" onclick="switchTab('pro')" class="tab-btn flex-1 py-4 font-semibold text-gray-600 hover:bg-gray-100">
                    <div>ç²¾æº– Pro</div><div class="text-xs opacity-80">120é¡Œçµ‚æ¥µè©•ä¼°</div><div id="pro-lock" class="text-xs text-red-500">ğŸ”’ éœ€è§£é–</div>
                </button>
            </div>

            <!-- å…§å®¹å€åŸŸ -->
            <div id="content-area" class="p-4 md:p-8 min-h-[500px]">
                <div class="flex items-center justify-center h-64">
                    <div class="text-center">
                        <div class="loading-spinner inline-block w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"></div>
                        <p class="text-gray-500">ç³»çµ±è¼‰å…¥ä¸­...</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- é å°¾ -->
        <footer class="mt-8 text-center text-gray-500 text-sm pb-8">
            <p>Â© 2024 MBTI Personality Insights. æœ¬æ¸¬é©—çµæœåƒ…ä¾›åƒè€ƒèˆ‡å¨›æ¨‚ç”¨é€”ã€‚</p>
            <p class="mt-1 text-xs">è§£é–é€²éšåŠŸèƒ½æœ‰åŠ©æ–¼æˆ‘å€‘æŒçºŒæä¾›å…è²»æœå‹™ï¼Œæ„Ÿè¬æ‚¨çš„æ”¯æŒã€‚</p>
        </footer>
    </div>

    <!-- è§£é–æˆåŠŸæ¨¡æ…‹æ¡† -->
    <div id="unlock-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-md w-full p-8">
            <div class="text-center">
                <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-green-100 to-emerald-100 flex items-center justify-center">
                    <svg class="w-10 h-10 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-2">è§£é–æˆåŠŸï¼</h3>
                <p id="modal-message" class="text-gray-600 mb-6"></p>
                <button onclick="closeModalAndRedirect()" class="w-full py-4 bg-primary text-white rounded-xl font-bold text-lg hover:bg-primary-dark transition-colors">
                    é–‹å§‹æ¸¬é©—
                </button>
            </div>
        </div>
    </div>

<script>
// ==================== å…¨å±€ç‹€æ…‹èˆ‡é…ç½® ====================
const STATE = {
    activeTab: 'basic',
    expertUnlocked: localStorage.getItem('expertUnlocked') === 'true',
    proUnlocked: localStorage.getItem('proUnlocked') === 'true',
    basicIndex: parseInt(localStorage.getItem('basicIndex')) || 0,
    basicAnswers: JSON.parse(localStorage.getItem('basicAnswers')) || [],
    basicCompleted: localStorage.getItem('basicCompleted') === 'true',
    unlockingTarget: null,
    unlockModalOpen: false
};

const AD_CONFIG = {
    GOOGLE_AUTO_AD: { client: 'ca-pub-2895749032536610', slot: '1132687996' },
    HILLTOP_EXPERT: { src: '//starry-perception.com/ctD.9M6Nbh2x5SltS-WzQy9-Naj/chywNGjdUF2QOTSX0y2ENwzIIA2GN/TmcTwl' },
    HILLTOP_PRO: { src: '//starry-perception.com/c.DX9y6jbT2/5Zl_StWYQa9dN/jPc_yZN/jeUG2FN/yV0o2NNNz/I/2/N/TKYx4_' }
};

// ==================== æ ¸å¿ƒé é¢åŠŸèƒ½ ====================
function initPage() {
    loadState();
    updateTabUI();
    renderContent();
    initAdSense();
}
function loadState() {
    if (STATE.expertUnlocked) hideLockBadge('expert');
    if (STATE.proUnlocked) hideLockBadge('pro');
}
function hideLockBadge(tab) {
    const badge = document.getElementById(`${tab}-lock`);
    if (badge) badge.style.display = 'none';
}
function switchTab(tabId) {
    if ((tabId === 'expert' && !STATE.expertUnlocked) || (tabId === 'pro' && !STATE.proUnlocked)) {
        if (tabId === 'expert' && !STATE.basicCompleted) {
            alert('è«‹å…ˆå®ŒæˆåŸºæœ¬æ¸¬é©—ã€‚'); switchTab('basic'); return;
        }
        if (tabId === 'pro' && !STATE.expertUnlocked) {
            alert('è«‹å…ˆè§£é–å°ˆå®¶æ¸¬é©—ã€‚'); switchTab('expert'); return;
        }
        STATE.activeTab = tabId; renderContent(); return;
    }
    STATE.activeTab = tabId; updateTabUI(); renderContent();
}
function updateTabUI() {
    ['basic','expert','pro'].forEach(id => {
        const btn = document.getElementById(`tab-${id}`);
        btn.classList.remove('bg-primary', 'text-white');
        btn.classList.add('text-gray-600', 'hover:bg-gray-100');
    });
    const activeBtn = document.getElementById(`tab-${STATE.activeTab}`);
    activeBtn.classList.add('bg-primary', 'text-white');
    activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-100');
}
function saveProgress() {
    localStorage.setItem('basicIndex', STATE.basicIndex);
    localStorage.setItem('basicAnswers', JSON.stringify(STATE.basicAnswers));
    localStorage.setItem('basicCompleted', STATE.basicCompleted);
    localStorage.setItem('expertUnlocked', STATE.expertUnlocked);
    localStorage.setItem('proUnlocked', STATE.proUnlocked);
}

// ==================== å…§å®¹æ¸²æŸ“å™¨ ====================
function renderContent() {
    const area = document.getElementById('content-area');
    if (!area) return;

    if (STATE.activeTab === 'basic') {
        area.innerHTML = STATE.basicCompleted ? renderBasicResults() : renderBasicQuiz();
    } else if (STATE.activeTab === 'expert') {
        area.innerHTML = STATE.expertUnlocked ? renderExpertContent() : renderLockedContent('expert', 'å°ˆå®¶æ¸¬é©— (69é¡Œ)', 'è§£é–å¾Œå¯ç²å¾—æ·±åº¦æ€§æ ¼åˆ†æã€è·æ¥­å»ºè­°èˆ‡äººéš›é—œä¿‚æŒ‡å—ã€‚');
    } else if (STATE.activeTab === 'pro') {
        area.innerHTML = STATE.proUnlocked ? renderProContent() : renderLockedContent('pro', 'ç²¾æº– Pro (120é¡Œ)', 'é€™æ˜¯æœ€é«˜ç´šåˆ¥çš„æ¸¬é©—ï¼Œæä¾›æœ€è©³ç´°çš„æ€§æ ¼å‰–æã€å€‹äººæˆé•·è¨ˆç•«èˆ‡å°ˆæ¥­ç™¼å±•è·¯å¾‘ã€‚');
    }
    // ç¢ºä¿å…§å®¹æ¸²æŸ“å¾Œï¼Œé é¢ä¸Šçš„å»£å‘Šèƒ½è¢«æ­£ç¢ºæ¨é€
    setTimeout(() => { (adsbygoogle = window.adsbygoogle || []).push({}); }, 300);
}

function renderLockedContent(target, title, description) {
    return `
        <div class="fade-in text-center py-8 md:py-12">
            <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-r from-gray-200 to-gray-300 flex items-center justify-center">
                <svg class="w-12 h-12 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
            </div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">${title}</h2>
            <p class="text-gray-600 mb-8 max-w-md mx-auto">${description}</p>
            
            <div class="max-w-lg mx-auto">
                <div class="bg-gradient-to-r from-orange-50 to-amber-50 p-6 rounded-xl border border-orange-200 mb-6">
                    <h4 class="text-lg font-bold text-gray-800 mb-3">å¦‚ä½•è§£é–ï¼Ÿ</h4>
                    <p class="text-gray-700 mb-4">é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œè§€çœ‹å®Œè´ŠåŠ©å•†æä¾›çš„å»£å‘Šå¾Œï¼Œå³å¯ç«‹å³è§£é–æ­¤æ¸¬é©—ã€‚æ‚¨çš„æ”¯æŒå¹«åŠ©æˆ‘å€‘æŒçºŒé‹ç‡Ÿã€‚</p>
                    
                    <button onclick="startUnlockProcess('${target}', this)" 
                            class="w-full py-4 bg-gradient-to-r from-orange-500 to-amber-500 text-white font-bold rounded-xl hover:opacity-90 transition-opacity text-lg">
                        ğŸ¬ è§€çœ‹å»£å‘Šè§£é– ${target === 'expert' ? 'å°ˆå®¶æ¸¬é©—' : 'ç²¾æº– Pro'}
                    </button>
                    <p class="unlock-ad-label mt-3">è§£é–éç¨‹ç´„éœ€5-10ç§’ï¼Œè«‹å‹¿é—œé–‰é é¢ã€‚</p>
                </div>
                
                <!-- æ­¤è™•æ”¾ç½® Google AdSense å»£å‘Š (è‡ªç„¶å±•ç¤º) -->
                <div class="mt-8 ad-slot rounded-lg flex items-center justify-center">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="${AD_CONFIG.GOOGLE_AUTO_AD.client}"
                         data-ad-slot="${AD_CONFIG.GOOGLE_AUTO_AD.slot}"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                </div>
            </div>
        </div>
    `;
}

// ==================== åŸºæœ¬æ¸¬é©—åŠŸèƒ½ ====================
const BASIC_QUESTIONS = [
    { id: 1, text: "ç¶“éä¸€æ•´å¤©çš„å·¥ä½œæˆ–ç¤¾äº¤æ´»å‹•å¾Œï¼Œæ‚¨é€šå¸¸çš„æ„Ÿè¦ºæ˜¯ï¼š", options: ["ç²¾åŠ›å……æ²›ï¼Œé‚„æƒ³ç¹¼çºŒæ´»å‹•æˆ–äº¤è«‡ (E)", "æ„Ÿåˆ°ç–²æ†Šï¼Œéœ€è¦ç¨è™•ä¾†å……é›» (I)"], dichotomy: 'EI' },
    { id: 2, text: "åœ¨ä¸€å€‹å……æ»¿äººçš„å ´åˆä¸­ï¼Œæ‚¨å‚¾å‘æ–¼ï¼š", options: ["ç©æ¥µåƒèˆ‡ä¸¦æ˜¯ä¸»è¦çš„ç™¼è¨€äººä¹‹ä¸€ (E)", "ä¿æŒè§€å¯Ÿï¼Œæ›´å–œæ­¡ä¸€å°ä¸€æˆ–å°çµ„æ·±åº¦äº¤æµ (I)"], dichotomy: 'EI' },
    { id: 3, text: "æ‚¨æ›´å–œæ­¡è™•ç†å“ªç¨®è¨Šæ¯ï¼Ÿ", options: ["åœ¨å¤–ç•Œç™¼ç”Ÿçš„ã€å…·é«”çš„ã€å¯è¦‹çš„æ´»å‹• (E)", "åœ¨è…¦æµ·ä¸­ç™¼ç”Ÿçš„ã€å…§çœçš„ã€æƒ³åƒä¸­çš„æ´»å‹• (I)"], dichotomy: 'EI' },
    { id: 4, text: "æ‚¨èªç‚ºå¤šæ•¸äººå°æ‚¨çš„ç­è§£ç¨‹åº¦æ˜¯ï¼š", options: ["ç›¸ç•¶ä¸éŒ¯ï¼Œå› ç‚ºæ‚¨å¾ˆé–‹æ”¾ (E)", "ä¸å¤ æ·±å…¥ï¼Œå› ç‚ºæ‚¨è¼ƒç‚ºå…§æ–‚ (I)"], dichotomy: 'EI' },
    { id: 5, text: "åœ¨å­¸ç¿’æ–°æ±è¥¿æ™‚ï¼Œæ‚¨æ›´é‡è¦–ï¼š", options: ["å¯¦éš›çš„æ‡‰ç”¨ã€ç•¶å‰çš„ç´°ç¯€å’Œæ˜ç¢ºçš„æ­¥é©Ÿ (S)", "ç†è«–åŸºç¤ã€æŠ½è±¡æ¦‚å¿µå’Œæœªä¾†çš„å¯èƒ½æ€§ (N)"], dichotomy: 'SN' },
    { id: 6, text: "æ‚¨æœ€äº«å—çš„å°è©±å…§å®¹æ˜¯é—œæ–¼ï¼š", options: ["æ‰‹é‚Šçš„ä»»å‹™ã€çœŸå¯¦ç™¼ç”Ÿçš„äº‹ä»¶æˆ–å¯¦ç”¨è³‡è¨Š (S)", "å“²å­¸ã€é è¦‹ã€æ–°ç©çš„æƒ³æ³•æˆ–æ¯”å–» (N)"], dichotomy: 'SN' },
    { id: 7, text: "æ‚¨é€šå¸¸ä¿¡ä»»ï¼š", options: ["æ‚¨çš„éå»ç¶“é©—å’Œç¶“éé©—è­‰çš„äº‹å¯¦ (S)", "æ‚¨çš„éˆæ„Ÿã€ç›´è¦ºæˆ–å°æ¨¡å¼çš„æ´å¯Ÿ (N)"], dichotomy: 'SN' },
    { id: 8, text: "æ‚¨èªç‚ºè‡ªå·±æ˜¯ä¸€å€‹ï¼š", options: ["å‹™å¯¦ä¸”è…³è¸å¯¦åœ°çš„äºº (S)", "å¯Œæœ‰æƒ³åƒåŠ›å’ŒåŸå‰µæ€§çš„äºº (N)"], dichotomy: 'SN' },
    { id: 9, text: "ç•¶æ‚¨åšé‡å¤§æ±ºå®šæ™‚ï¼Œæ‚¨æœƒï¼š", options: ["ä¿æŒå®¢è§€ï¼Œæ¬Šè¡¡é‚è¼¯ã€æ•ˆç‡å’Œåˆ©å¼Š (T)", "è€ƒæ…®å°ä»–äººçš„å½±éŸ¿ã€æƒ…æ„Ÿåƒ¹å€¼å’Œå€‹äººæƒ…æ³ (F)"], dichotomy: 'TF' },
    { id: 10, text: "åœ¨æ‰¹è©•æˆ–æå‡ºåå°æ„è¦‹æ™‚ï¼Œæ‚¨å‚¾å‘æ–¼ï¼š", options: ["ç›´æ¥ã€å¦èª ï¼Œå°ˆæ³¨æ–¼å•é¡Œçš„è§£æ±º (T)", "æº«å’Œã€åœ“æ»‘ï¼Œç›¡é‡ç¶­è­·å’Œè«§çš„é—œä¿‚ (F)"], dichotomy: 'TF' },
    { id: 11, text: "æ‚¨èªç‚ºç¨±è®šä¸€å€‹äººæœ€å¥½æ˜¯ç¨±è®šå…¶ï¼š", options: ["æ™ºæ…§ã€é‚è¼¯æ€ç¶­æˆ–å…¬å¹³æ€§ (T)", "å–„è‰¯ã€åŒç†å¿ƒæˆ–ç†±å¿ƒåŠ©äºº (F)"], dichotomy: 'TF' },
    { id: 12, text: "æ‚¨èªç‚ºå…¬æ­£çš„æ±ºå®šæ‡‰è©²åŸºæ–¼ï¼š", options: ["ä¸€å¥—çµ±ä¸€ã€éå€‹äººçš„æ¨™æº– (T)", "æ¯å€‹äººçš„ç¨ç‰¹éœ€æ±‚å’Œåƒ¹å€¼è§€ (F)"], dichotomy: 'TF' },
    { id: 13, text: "å°æ–¼å‡æœŸæˆ–å¤§å°ˆæ¡ˆï¼Œæ‚¨å‚¾å‘æ–¼ï¼š", options: ["æå‰è¨ˆç•«ã€ç¢ºå®šç´°ç¯€ä¸¦æŒ‰æ™‚å®Œæˆ (J)", "ä¿æŒå½ˆæ€§ã€é–‹æ”¾é¸æ“‡ï¼Œä¸¦åœ¨ç•¶ä¸‹æ±ºå®š (P)"], dichotomy: 'JP' },
    { id: 14, text: "æ‚¨é€šå¸¸è¦ºå¾—æˆªæ­¢æ—¥æœŸæ˜¯ï¼š", options: ["å¿…é ˆéµå®ˆçš„ï¼Œé€™è®“æ‚¨æœ‰æ¢ç†åœ°å·¥ä½œ (J)", "å¯ä»¥èª¿æ•´çš„ï¼Œé€™è®“æ‚¨èƒ½å¤ é©æ‡‰è®ŠåŒ– (P)"], dichotomy: 'JP' },
    { id: 15, text: "æ‚¨çš„å·¥ä½œæˆ–ç”Ÿæ´»ç©ºé–“é€šå¸¸æ˜¯ï¼š", options: ["æ•´æ½”ã€æœ‰åºï¼Œæ‰€æœ‰æ±è¥¿éƒ½æœ‰å›ºå®šçš„ä½ç½® (J)", "éš¨æ€§ã€æœ‰æ©Ÿï¼Œé›œäº‚ä½†æ‚¨çŸ¥é“æ±è¥¿åœ¨å“ª (P)"], dichotomy: 'JP' },
    { id: 16, text: "æ‚¨å°‡ç”Ÿæ´»è¦–ç‚ºï¼š", options: ["éœ€è¦è¢«æ§åˆ¶ã€çµ„ç¹”å’Œåšå‡ºçµè«–çš„çµæ§‹ (J)", "éœ€è¦è¢«é«”é©—ã€æ¢ç´¢å’Œä¿æŒé–‹æ”¾çš„éç¨‹ (P)"], dichotomy: 'JP' },
];

function renderBasicQuiz() {
    const q = BASIC_QUESTIONS[STATE.basicIndex];
    const answered = STATE.basicAnswers.filter(a => a !== undefined).length;
    const progressPercent = (answered / 16) * 100;
    return `
        <div class="fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">åŸºæœ¬äººæ ¼æ¸¬é©— (16é¡Œ)</h2>
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="flex justify-between mb-2"><span>æ¸¬é©—é€²åº¦</span><span class="font-bold text-primary">${answered}/16</span></div>
                    <div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-primary h-2 rounded-full transition-all duration-500" style="width: ${progressPercent}%"></div></div>
                </div>
            </div>
            <div class="mb-8">
                <span class="inline-block text-sm font-medium text-primary bg-primary/10 px-3 py-1 rounded-full mb-4">ç¬¬ ${STATE.basicIndex + 1} é¡Œ / 16</span>
                <h3 class="question-text text-xl font-semibold text-gray-800 mb-6">${q.text}</h3>
                <div class="space-y-3">${q.options.map((opt, idx) => `
                    <button onclick="submitAnswer(${idx})" class="w-full p-4 text-left rounded-xl border-2 transition-all duration-200 ${STATE.basicAnswers[STATE.basicIndex] === idx ? 'border-primary bg-primary/5 shadow-md' : 'border-gray-200 hover:border-primary/50 hover:bg-gray-50'}">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center mr-3 ${STATE.basicAnswers[STATE.basicIndex] === idx ? 'border-primary bg-primary text-white' : 'border-gray-300'}">${String.fromCharCode(65 + idx)}</div>
                            <span class="flex-1">${opt}</span>
                            ${STATE.basicAnswers[STATE.basicIndex] === idx ? '<svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : ''}
                        </div>
                    </button>`).join('')}
                </div>
            </div>
            <div class="flex justify-between pt-6 border-t border-gray-200">
                <button onclick="goPrev()" ${STATE.basicIndex === 0 ? 'disabled' : ''} class="px-6 py-3 rounded-lg font-medium ${STATE.basicIndex === 0 ? 'text-gray-400 cursor-not-allowed' : 'text-primary hover:bg-primary/10'}">â† ä¸Šä¸€é¡Œ</button>
                <button onclick="goNext()" ${STATE.basicAnswers[STATE.basicIndex] === undefined ? 'disabled' : ''} class="px-6 py-3 rounded-lg font-medium ${STATE.basicAnswers[STATE.basicIndex] === undefined ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-primary text-white hover:bg-primary-dark'}">${STATE.basicIndex === 15 ? 'å®Œæˆæ¸¬é©—' : 'ä¸‹ä¸€é¡Œ â†’'}</button>
            </div>
        </div>
    `;
}
function submitAnswer(idx) { STATE.basicAnswers[STATE.basicIndex] = idx; saveProgress(); renderContent(); }
function goPrev() { if (STATE.basicIndex > 0) { STATE.basicIndex--; saveProgress(); renderContent(); } }
function goNext() {
    if (STATE.basicAnswers[STATE.basicIndex] === undefined) { alert('è«‹é¸æ“‡ä¸€å€‹ç­”æ¡ˆ'); return; }
    if (STATE.basicIndex < 15) { STATE.basicIndex++; saveProgress(); renderContent(); }
    else { STATE.basicCompleted = true; saveProgress(); renderContent(); }
}

// ==================== æ¸¬é©—çµæœèˆ‡è§£é– ====================
function calculateResult() {
    const scores = { E:0, I:0, S:0, N:0, T:0, F:0, J:0, P:0 };
    BASIC_QUESTIONS.forEach((q, i) => {
        const ans = STATE.basicAnswers[i];
        if (ans !== undefined) { scores[q.dichotomy[ans === 0 ? 0 : 1]]++; }
    });
    const type = `${scores.E >= scores.I ? 'E':'I'}${scores.S >= scores.N ? 'S':'N'}${scores.T >= scores.F ? 'T':'F'}${scores.J >= scores.P ? 'J':'P'}`;
    const descriptions = {
        'ISTJ': 'ç‰©æµå¸« (Logistician)', 'ISFJ': 'å®ˆè¡›è€… (Defender)', 'INFJ': 'æå€¡è€… (Advocate)', 'INTJ': 'å»ºç¯‰å¸« (Architect)',
        'ISTP': 'æ¢éšªå®¶ (Virtuoso)', 'ISFP': 'è—è¡“å®¶ (Adventurer)', 'INFP': 'èª¿åœè€… (Mediator)', 'INTP': 'é‚è¼¯å­¸å®¶ (Logician)',
        'ESTP': 'ä¼æ¥­å®¶ (Entrepreneur)', 'ESFP': 'è¡¨æ¼”è€… (Entertainer)', 'ENFP': 'ç«¶é¸è€… (Campaigner)', 'ENTP': 'è¾¯è«–å®¶ (Debater)',
        'ESTJ': 'ç¸½ç¶“ç† (Executive)', 'ESFJ': 'åŸ·æ”¿å®˜ (Consul)', 'ENFJ': 'ä¸»äººå…¬ (Protagonist)', 'ENTJ': 'æŒ‡æ®å®˜ (Commander)'
    };
    return { type, title: descriptions[type] || 'æ¢ç´¢è€…', dimensions: [
        {label:'å¤–å‘/å…§å‘', pct: Math.round((scores.E / (scores.E+scores.I || 1)) * 100), left:'E', right:'I'},
        {label:'å¯¦æ„Ÿ/ç›´è¦º', pct: Math.round((scores.S / (scores.S+scores.N || 1)) * 100), left:'S', right:'N'},
        {label:'æ€è€ƒ/æƒ…æ„Ÿ', pct: Math.round((scores.T / (scores.T+scores.F || 1)) * 100), left:'T', right:'F'},
        {label:'åˆ¤æ–·/æ„ŸçŸ¥', pct: Math.round((scores.J / (scores.J+scores.P || 1)) * 100), left:'J', right:'P'}
    ]};
}
function renderBasicResults() {
    const r = calculateResult();
    const progressPercent = (STATE.basicAnswers.filter(a => a !== undefined).length / 16) * 100;
    return `
        <div class="fade-in">
            <div class="bg-gradient-to-r from-primary/5 to-secondary/5 p-6 rounded-2xl mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-2">ğŸ‰ åŸºæœ¬æ¸¬é©—å®Œæˆï¼</h3>
                <p class="text-gray-600">æ‚¨çš„æ ¸å¿ƒäººæ ¼é¡å‹åˆ†æå¦‚ä¸‹ã€‚</p>
            </div>
            <div class="text-center mb-8">
                <div class="text-6xl font-bold text-primary mb-2">${r.type}</div>
                <div class="text-xl font-semibold text-gray-700 mb-4">${r.title}</div>
            </div>
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                ${r.dimensions.map(d => `
                    <div class="bg-white p-4 rounded-xl border border-gray-200">
                        <div class="flex justify-between mb-2"><span class="font-medium">${d.label}</span><span class="text-primary font-bold">${d.pct}%</span></div>
                        <div class="w-full bg-gray-100 rounded-full h-2"><div class="bg-primary h-2 rounded-full" style="width: ${d.pct}%"></div></div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>${d.left}</span><span>${d.right}</span></div>
                    </div>`).join('')}
            </div>
            <div class="text-center mb-8">
                <p class="text-gray-600 mb-6">æƒ³è¦æ›´ç²¾æº–ã€æ›´æ·±å…¥çš„æ€§æ ¼åˆ†æèˆ‡å€‹äººåŒ–ç™¼å±•å»ºè­°å—ï¼Ÿ</p>
                <div class="inline-flex flex-col sm:flex-row gap-4">
                    <button onclick="switchTab('expert')" class="px-8 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white font-bold rounded-xl hover:opacity-90 transition-opacity">
                        è§£é–å°ˆå®¶æ¸¬é©— (69é¡Œ)
                    </button>
                    <button onclick="location.reload()" class="px-8 py-3 border-2 border-primary text-primary font-bold rounded-xl hover:bg-primary/10 transition-colors">
                        é‡æ–°æ¸¬è©¦
                    </button>
                </div>
            </div>
            <!-- è‡ªç„¶å±•ç¤ºçš„ Google AdSense å»£å‘Š -->
            <div class="mt-8 ad-slot rounded-lg flex items-center justify-center">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="${AD_CONFIG.GOOGLE_AUTO_AD.client}"
                     data-ad-slot="${AD_CONFIG.GOOGLE_AUTO_AD.slot}"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
            </div>
        </div>
    `;
}
function renderExpertContent() { return `<div class="text-center py-12 fade-in"><h3 class="text-2xl font-bold text-gray-800 mb-4">å°ˆå®¶æ¸¬é©—æº–å‚™ä¸­</h3><p class="text-gray-600">æ‚¨å·²è§£é–å°ˆå®¶æ¸¬é©—ï¼Œæ›´å¤šåŠŸèƒ½å³å°‡æ¨å‡ºï¼</p></div>`; }
function renderProContent() { return `<div class="text-center py-12 fade-in"><h3 class="text-2xl font-bold text-gray-800 mb-4">ç²¾æº– Pro æ¸¬é©—æº–å‚™ä¸­</h3><p class="text-gray-600">æ‚¨å·²è§£é–æœ€é«˜ç´šåˆ¥æ¸¬é©—ï¼Œæ›´å¤šåŠŸèƒ½å³å°‡æ¨å‡ºï¼</p></div>`; }

// ==================== å»£å‘Šèˆ‡è§£é–æ ¸å¿ƒé‚è¼¯ ====================
function initAdSense() {
    if (typeof adsbygoogle !== 'undefined') {
        setTimeout(() => { (adsbygoogle = window.adsbygoogle || []).push({}); }, 1500);
    }
}
function getHilltopAdScript(target) {
    const src = target === 'expert' ? AD_CONFIG.HILLTOP_EXPERT.src : AD_CONFIG.HILLTOP_PRO.src;
    return `<script>(function(_){var d=document,s=d.createElement('script'),l=d.scripts[d.scripts.length-1];s.settings=_||{};s.src="${src}";s.async=true;s.referrerPolicy='no-referrer-when-downgrade';l.parentNode.insertBefore(s,l);})({})<\/script>`;
}
function startUnlockProcess(target, buttonElement) {
    if (buttonElement.disabled) return;
    if (typeof adsbygoogle === 'undefined') { alert('è«‹æš«æ™‚åœç”¨å»£å‘Šæ””æˆªå™¨ä»¥æ”¯æŒæˆ‘å€‘ã€‚'); return; }

    STATE.unlockingTarget = target;
    buttonElement.disabled = true;
    const originalText = buttonElement.innerHTML;
    buttonElement.innerHTML = '<span class="pulse-loading">æ­£åœ¨æº–å‚™å»£å‘Š...</span>';
    buttonElement.classList.add('opacity-75');

    // 1. æ’å…¥ HilltopAds è…³æœ¬ï¼ˆä¸»è¦è§£é–æ¢ä»¶ï¼‰
    document.body.insertAdjacentHTML('beforeend', getHilltopAdScript(target));
    console.log(`å·²è§¸ç™¼ ${target} è§£é–å»£å‘Š`);

    // 2. é–‹å§‹å€’æ•¸è¨ˆæ™‚èˆ‡ç”¨æˆ¶æç¤º
    let countdown = 8;
    const countdownInterval = setInterval(() => {
        if (countdown > 0) {
            buttonElement.innerHTML = `è«‹è§€çœ‹å»£å‘Š (${countdown}ç§’å¾Œè‡ªå‹•ç¹¼çºŒ)...`;
            countdown--;
        } else {
            clearInterval(countdownInterval);
            finalizeUnlock(target, buttonElement, originalText);
        }
    }, 1000);
}
function finalizeUnlock(target, buttonElement, originalText) {
    buttonElement.innerHTML = 'æ­£åœ¨é©—è­‰ä¸¦è§£é–...';
    setTimeout(() => {
        if (target === 'expert') {
            STATE.expertUnlocked = true;
            hideLockBadge('expert');
            showUnlockModal('å°ˆå®¶æ¸¬é©—è§£é–æˆåŠŸï¼', 'ç¾åœ¨æ‚¨å¯ä»¥é–‹å§‹é€²è¡Œ69é¡Œæ·±åº¦æ€§æ ¼åˆ†æã€‚', 'expert');
        } else if (target === 'pro') {
            STATE.proUnlocked = true;
            hideLockBadge('pro');
            showUnlockModal('ç²¾æº– Pro è§£é–æˆåŠŸï¼', 'ç¾åœ¨æ‚¨å¯ä»¥é–‹å§‹é€²è¡Œ120é¡Œçµ‚æ¥µæ€§æ ¼è©•ä¼°ã€‚', 'pro');
        }
        saveProgress();
        buttonElement.disabled = false;
        buttonElement.innerHTML = originalText;
        buttonElement.classList.remove('opacity-75');
    }, 1500);
}
function showUnlockModal(title, message, target) {
    STATE.unlockingTarget = target;
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-message').textContent = message;
    document.getElementById('unlock-modal').classList.remove('hidden');
    document.getElementById('unlock-modal').classList.add('flex');
}
function closeModalAndRedirect() {
    document.getElementById('unlock-modal').classList.add('hidden');
    document.getElementById('unlock-modal').classList.remove('flex');
    if (STATE.unlockingTarget) { switchTab(STATE.unlockingTarget); }
    STATE.unlockingTarget = null;
}

// ==================== é é¢åˆå§‹åŒ– ====================
document.addEventListener('DOMContentLoaded', initPage);
</script>
</body>
</html>
